<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Azure AD に登録できる 「アプリ」と「リソース」、「API 権限」を理解する | Japan Azure Identity Support Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="こんにちは、Azure ID チームの埴山です。 本記事は Azure Tech Advent Calendar 4 日目の記事です。 今回はトラブルシューティングの方法ではなく、Azure AD を利用したアプリケーション開発における、”API 権限” について説明します。特に Microsoft Graph API を題材に API エコシステムの中身を見ていきます。 Azure AD を利用">
<meta property="og:type" content="article">
<meta property="og:title" content="Azure AD に登録できる 「アプリ」と「リソース」、「API 権限」を理解する">
<meta property="og:url" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/index.html">
<meta property="og:site_name" content="Japan Azure Identity Support Blog">
<meta property="og:description" content="こんにちは、Azure ID チームの埴山です。 本記事は Azure Tech Advent Calendar 4 日目の記事です。 今回はトラブルシューティングの方法ではなく、Azure AD を利用したアプリケーション開発における、”API 権限” について説明します。特に Microsoft Graph API を題材に API エコシステムの中身を見ていきます。 Azure AD を利用">
<meta property="og:locale" content="ja_JP">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/oauth-flow.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/delegated-and-app-permissions.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/01.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/02.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/03.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/04.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/05.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/06.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/07.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/08.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/09.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/10.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/11.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/14.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/12.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/oauth-flow-2.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/15.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/16.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/17.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/oauth-flow-3.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/oauth-flow-4.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/app-oauth-flow.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/app-permissions.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/app-permissions-2.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/app-oauth-flow-2.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/api-diagram.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/api-registration.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/api-uri.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/api-scope-create.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/api-scope.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/api-role-create.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/api-manifest.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/api-consent.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/api-response.png">
<meta property="og:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/api-diagram-detail.png">
<meta property="article:published_time" content="2020-12-03T15:00:00.000Z">
<meta property="article:modified_time" content="2024-06-11T07:19:23.699Z">
<meta property="article:author" content="Azure Identity Support Japan">
<meta property="article:tag" content="Azure AD">
<meta property="article:tag" content="OAuth">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/oauth-flow.png">
  
    <link rel="alternate" href="../../atom.xml" title="Japan Azure Identity Support Blog" type="application/atom+xml">
  

  <link rel="icon" href="../../favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
  <link rel="manifest" href="../../site.webmanifest">
  <link rel="mask-icon" href="../../safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="theme-color" content="#ffffff">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="../../css/style.css">

  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="site-header-logo"></div>
  <div id="site-header-blog-wrapper"></div>
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        <div id="ms-logo"></div>
        
          <a class="main-nav-link" href="/blog/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
        <a class="main-nav-link" target="_blank" rel="noopener" href="https://cssjpn.github.io/">サポート情報</a>
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="../../atom.xml" title="RSSフィード"></a>
        
      </nav>
      <div id="search-form-wrap">
        <form action="//www.bing.com/search" method="get" accept-charset="UTF-8" name="bing-search" onsubmit="var f=this;if(f['q'].value){var searchUrl =  'https://www.bing.com/search?q=' +  encodeURIComponent(f['q'].value + ' site:' + f['sitesearch'].value) ;window.open(searchUrl, 'blank') };return false;" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="検索"><button type="submit" id="nav-search-btn" class="search-form-submit"></button><input type="hidden" name="sitesearch" value="https://jpazureid.github.io/blog"></form>
      </div>
    </div>
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="../../index.html" id="logo">Japan Azure Identity Support Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="../../index.html" id="subtitle">日本マイクロソフトの Azure Active Directory と AD FS に関するサポート情報のブログです。</a>
        </h2>
      
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-azure-active-directory/oauth2-application-resource-and-api-permissions" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header-single">
        
  
    <h1 class="article-title" itemprop="name">
      Azure AD に登録できる 「アプリ」と「リソース」、「API 権限」を理解する
    </h1>
  

      </header>
      <div class="article-share">
        Published: 
        <a href="" class="article-date-single">
  <time datetime="2020-12-03T15:00:00.000Z" itemprop="datePublished">2020-12-04</time>
</a>
        
          / Last update: <a id="update-time" class="article-date-single"></a>
/ Contributors: <ul style="display: inline-block; list-style:none" id="contributors" class="github-contributors"> </ul>

<script type="text/javascript">
  const sourceUrl = "https://github.com/jpazureid/blog/blob/main/articles/azure-active-directory/oauth2-application-resource-and-api-permissions.md";
  const urlParts = sourceUrl.split("/");
  const user = urlParts[3];
  const repo = urlParts[4];
  const filePath = urlParts.slice(7).join("/");
  const apiUrl = `https://api.github.com/repos/${user}/${repo}/commits?path=${filePath}`;
  function formatDate(date) {
    let year = date.getFullYear();
    let month = date.getMonth() + 1;
    let day = date.getDate();

    if (month < 10) {
      month = '0' + month;
    }
    if (day < 10) {
      day = '0' + day;
    }

    return year + '-' + month + '-' + day;
  }

  $.getJSON(apiUrl, function (data) {
    const commit = data[0];
    const updateDate = new Date(commit.commit.author.date);
    const localDate = formatDate(updateDate);
    const contributors = new Map();

    data.reverse().forEach(function (commit) {
      if (commit.author == null) {
        return;
      } else {
        const name = commit.author.login;
        const url = commit.author.html_url;
        const avatar = commit.author.avatar_url;
        contributors.set(name, { name, url, avatar });
      }
    });

    $("#update-time").text(localDate);
    $("#update-time").href = commit.html_url;
    Array.from(contributors, ([_, value]) => value).reverse().forEach(function (contributor) {
      $("#contributors").append(`<li class="contributor-avatar"><a target="_blank" rel="noopener" href="https://github.com/${contributor.name}" title="${contributor.name}"><img src="${contributor.avatar}" alt="${contributor.name}"/></a></li>`);
    });
  });
</script>
        
        
        
        <a href="https://github.com/jpazureid/blog/issues/new?title=&body=%0A%0A---%0A%0A%23%23%23%23+Document+Details%0A%0A%E2%9A%A0+*Do+not+edit+this+section.%0A%0A*+ID%3A+36b87b76-9ddd-5f3a-becd-c6356f2580ae%0A*+%E5%AF%BE%E8%B1%A1%E8%A8%98%E4%BA%8B%3A+%5BAzure+AD+%E3%81%AB%E7%99%BB%E9%8C%B2%E3%81%A7%E3%81%8D%E3%82%8B+%E3%80%8C%E3%82%A2%E3%83%97%E3%83%AA%E3%80%8D%E3%81%A8%E3%80%8C%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%80%8D%E3%80%81%E3%80%8CAPI+%E6%A8%A9%E9%99%90%E3%80%8D%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B%5D%28https%3A%2F%2Fjpazureid.github.io%2Fblog%2Fazure-active-directory%2Foauth2-application-resource-and-api-permissions%2F%29%0A*+Content+Source%3A+%5Barticles%2Fazure-active-directory%2Foauth2-application-resource-and-api-permissions.md%5D%28https%3A%2F%2Fgithub.com%2Fjpazureid%2Fblog%2Fblob%2Fmain%2Farticles%2Fazure-active-directory%2Foauth2-application-resource-and-api-permissions.md%29%0A*+Author%3A+" class="article-github-issue-link" target="_blank" rel="noopener noreferrer">feedback</a>
        
        <a data-url="https://jpazureid.github.io/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/" data-id="clxa2nbq6013n0nqo7jydd29v" class="article-share-link">共有</a>
      </div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>こんにちは、Azure ID チームの埴山です。</p>
<p>本記事は <a target="_blank" rel="noopener" href="https://qiita.com/advent-calendar/2020/microsoft-azure-tech">Azure Tech Advent Calendar</a> 4 日目の記事です。</p>
<p>今回はトラブルシューティングの方法ではなく、Azure AD を利用したアプリケーション開発における、”API 権限” について説明します。特に Microsoft Graph API を題材に API エコシステムの中身を見ていきます。</p>
<p>Azure AD を利用してアプリ開発を検討している方や、Azure AD における OAuth の実装について詳しく知りたい方への記事となります。<br>チュートリアルなどについては、一通り動かしたことのある方を対象とした記事ですので、Azure AD で保護されたアプリケーション開発の基礎については <a target="_blank" rel="noopener" href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/">Microsoft ID プラットフォームのドキュメント | Microsoft Docs</a> の公開ドキュメントをご確認ください。</p>
<h2 id="OAuth-と-Azure-AD"><a href="#OAuth-と-Azure-AD" class="headerlink" title="OAuth と Azure AD"></a>OAuth と Azure AD</h2><p>OAuth は「リソース」へのアクセス権を安全に委譲し、API を保護するための「トークン」を発行する仕組みのデファクトスタンダードです。Microsoft では Exchange Online や SharePoint Online といった「リソース」に対するアクセスするための「API」を OAuth の仕組みを使って保護しており、ユーザーは必要な権限を必要に応じて「クライアント」であるアプリに払い出すことが可能です。これらの権限管理を行っているのが Azure AD です。</p>
<p>ここでは OAuth の基礎については説明を省きますが、Azure AD にアプリを登録することで、Microsoft が管理する Azure AD で保護された「リソース」へのアクセスを行う「クライアント」を作成したり、自社で開発した API を「リソース」として登録し Azure AD で保護したりすることができます。リソースへのアクセス権は Azure AD では API のアクセス許可とよばれます。<br>API のアクセス許可は「トークン」という形で「クライアント」であるアプリに受け渡されます。例えばユーザーが、ユーザー情報を取得できる API のアクセス許可を、クライアントであるアプリに許可することが可能です。アクセス許可を付与されたアプリケーションは、アクセス トークンというトークンを取得し、ユーザーの情報を取得する API を呼び出すことが可能になります。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/oauth-flow.png"></p>
<p>アプリが取得できる権限として、ユーザー委任のアクセス許可と、アプリケーション権限のアクセス許可の二つがあります。前者がユーザーの同意を得て、ユーザーの権限相当のアクセス権を取得できるのに対し、後者は管理者がアプリに権限を付与 (管理者の同意) することで、アプリケーション自身に権限を付与し、アプリ自身が API のアクセス権を得ることができます。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/delegated-and-app-permissions.png"></p>
<p>ただし、あくまでここで取得できる権限は API のアクセス許可であり、実際のリソースへのアクセス権はリソースオーナー、つまり Exchange Online や SharePoint Online が管理していることに注意してください。たとえば、あるユーザーがユーザー委任のメールの読み込み権限をアプリに付与したからといって、対象のユーザーがアクセスできないメールボックスの読み込みを行うことはできません。つまり、ユーザーがアクセスできるリソースの範囲は、API のアクセス許可と、リソース側の権限管理の両方で制御されています。</p>
<p>本記事ではこれらの API のアクセス許可の実体について深堀していきます。</p>
<h2 id="サンプルアプリを動作させる"><a href="#サンプルアプリを動作させる" class="headerlink" title="サンプルアプリを動作させる"></a>サンプルアプリを動作させる</h2><p>まずは実際に Microsoft Graph API を呼び出すサンプルを動かし、その動作を見てみましょう。</p>
<p>後程、テナントに同意された権限などを確認するために、テナントのグローバル管理者権限が必要となってきます。そのためサンプルの動作はテストテナントを作成しお試しいただくことをお勧めします。<br>また今回紹介するアプリの実際の動作のためには <a target="_blank" rel="noopener" href="https://nodejs.org/en/">Node.js</a> のインストールが必要です。</p>
<div class="alert is-info"><p class="alert-title">Note</p><p>Microsoft Graph API を呼び出すちょうどいいサンプルが、node.js だったので</p></div>
<h3 id="アプリの登録とサンプルのダウンロード"><a href="#アプリの登録とサンプルのダウンロード" class="headerlink" title="アプリの登録とサンプルのダウンロード"></a>アプリの登録とサンプルのダウンロード</h3><p>Azure Active Directory &gt; <a target="_blank" rel="noopener" href="https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/RegisteredApps">アプリの登録</a> から新規アプリを登録します。</p>
<p>名前は <code>MS Graph Client Sample</code> としましょう。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/01.png"></p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/02.png"></p>
<p>設定はデフォルトのまま作成します。そのまま<code>クイック スタート</code>をクリックし、<code>シングルページ アプリケーション (SPA)</code> を選択します。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/03.png"></p>
<p>続いて JavaScript (認証コード フロー) を選択します。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/04.png"></p>
<p><code>これらの変更を行います</code> ボタンをクリックし、サンプルの動作に必要な設定を変更します。<br><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/05.png"><br><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/06.png"></p>
<p>続けてプロジェクトのダウンロードです。 <code>コード サンプルをダウンロードします</code> をクリックしダウンロードした zip ファイルを適当な場所に展開します。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/07.png"></p>
<h3 id="サンプルの動作"><a href="#サンプルの動作" class="headerlink" title="サンプルの動作"></a>サンプルの動作</h3><p>PowerShell を起動し、コードサンプルを展開したフォルダーに移動します。ちなみにエクスプローラーの検索窓に powershell と入力すると、開いているフォルダーから PowerShell を起動できます。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/08.png"></p>
<p>クイック スタートにある通り npm install および npm start コマンドを実行します。</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">npm install</span><br><span class="line">npm <span class="built_in">start</span></span><br></pre></td></tr></table></figure>

<p><code>http://localhost:3000/</code> でアプリが起動しますので、ブラウザーでアクセスします。</p>
<h3 id="動作の確認"><a href="#動作の確認" class="headerlink" title="動作の確認"></a>動作の確認</h3><p><code>Sign In</code> ボタンをクリックし、ユーザーの資格情報を入力すると　API のアクセス許可の同意画面が出てきます。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/09.png"></p>
<p><code>承諾</code> をクリックするとこで、サインインが完了します。この際、Azure AD からアプリに対し ID トークンとアクセス トークンが発行されています。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/10.png"></p>
<div class="alert is-info"><p class="alert-title">Note</p><p>※ 今回は ID トークンの詳細や使い道については説明しません。</p></div>
<p><code>See Profile</code> ボタンをクリックすることで、取得したアクセス トークンを使ってユーザーのプロファイル情報を取得できます。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/11.png"><br><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/14.png"></p>
<p>次に <code>Read Mails</code> ボタンをクリックしてみましょう。<br>すると、新たに <code>Read your mail</code> の API のアクセス許可を求める同意画面が表示され、<code>同意</code> をクリックすることでメールを読み込むためのトークンが取得されます。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/12.png"></p>
<p>※ テストユーザーは Exchange Online のライセンスを持っていなかったので API の呼び出しには失敗しています。</p>
<h2 id="何がおこったのか"><a href="#何がおこったのか" class="headerlink" title="何がおこったのか"></a>何がおこったのか</h2><p>これまでの操作をまとめてみましょう。<br>今回、新しいアプリケーションを Azure AD に登録し、ユーザー プロファイルの表示ができる API のアクセス許可と、メールの読み込みの API のアクセス許可を要求しました。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/oauth-flow-2.png"></p>
<p>要求に対しユーザーの同意画面が現れ、同意を行うことでアプリがアクセス トークンを取得できるようになりました。<br>アプリは取得したアクセス トークンを使って Microsoft Graph API を呼び出し、ユーザー情報やメールの読み込みを行いました。</p>
<p>これらの裏でどのようなことが起こっていたのでしょうか。より詳細に見てみましょう。</p>
<h3 id="エンタープライズ-アプリケーションと-API-のアクセス許可"><a href="#エンタープライズ-アプリケーションと-API-のアクセス許可" class="headerlink" title="エンタープライズ アプリケーションと API のアクセス許可"></a>エンタープライズ アプリケーションと API のアクセス許可</h3><p>ユーザーが作成したクライアント アプリは、Azure ポータルの “アプリの登録” に登録されます。と、同時に API の権限の同意結果を保存する “エンタープライズ アプリケーション” が作成されます。<br>詳細を確認するために作成したアプリのプロパティに表示される “ローカル ディレクトリでのマネージド アプリケーション” をクリックしてみましょう。(<code>Azure Active Directory</code> &gt; <code>エンタープライズ アプリケーション</code> と移動し検索しても OK です。)</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/15.png"></p>
<p>表示されたサービス プリンシパルの <code>アクセス許可</code> を確認します。ユーザー同意のタブを見ると、先ほどユーザーが同意した API のアクセス許可が登録されています。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/16.png"></p>
<p>詳細を確認すると、たとえば <code>User.Read</code> のスコープに同意済みであることなどが確認できます。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/17.png"></p>
<p>4 つのアクセス許可をよく見てみると、クレームの値が <code>openid</code>, <code>profile</code>, <code>User.Read</code>, <code>Mail.Read</code> であることが確認できるかと思います。</p>
<h3 id="API-のアクセス許可と-scope"><a href="#API-のアクセス許可と-scope" class="headerlink" title="API のアクセス許可と scope"></a>API のアクセス許可と scope</h3><p>これらの 4 つのクレームの値は何を表しているのでしょうか。</p>
<p>実は先ほどのサインイン時に、アプリケーションは Azure AD の認可エンドポイントに対し、scope を指定し<a target="_blank" rel="noopener" href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/v2-oauth2-auth-code-flow#request-an-authorization-code">認可要求 (承認コードを要求)</a>を送っていました。<br>要求するパラメーターはサンプルの <code>app/authConfig.js</code> 内で、以下のように指定されています。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Add here the scopes that you would like the user to consent during sign-in</span></span><br><span class="line"><span class="keyword">const</span> loginRequest = &#123;</span><br><span class="line">    <span class="attr">scopes</span>: [<span class="string">&quot;User.Read&quot;</span>]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add here the scopes to request when obtaining an access token for MS Graph API</span></span><br><span class="line"><span class="keyword">const</span> tokenRequest = &#123;</span><br><span class="line">    <span class="attr">scopes</span>: [<span class="string">&quot;User.Read&quot;</span>, <span class="string">&quot;Mail.Read&quot;</span>],</span><br><span class="line">    <span class="attr">forceRefresh</span>: <span class="literal">false</span> <span class="comment">// Set this to &quot;true&quot; to skip a cached token and go to the server to get a new token</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>コードを確認していただければわかりますが <code>loginRequest</code> がサインイン時に、<code>tokenRequest</code> がメール読み込み時に要求される scope です。</p>
<div class="alert is-info"><p class="alert-title">Note</p><p>※ msal.js では loginPopup 呼び出し時、自動で socpe に openid profile を追加するため、最終的に同意した API の権限は、<code>openid</code>, <code>profile</code>, <code>User.Read</code>, <code>Mail.Read</code> の 4 つとなります。</p></div>
<p>つまり、ユーザー委任の API のアクセス許可イコール、scope と呼ばれる単位で管理されていることがわかります。</p>
<p>このようにユーザーがアプリに同意を行うことで、ユーザーの同意情報がサービス プリンシパルに保存され、アプリはユーザーの代わりに API の呼び出しを実施することが可能になるのです。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/oauth-flow-3.png"></p>
<h2 id="Microsoft-Graph-API"><a href="#Microsoft-Graph-API" class="headerlink" title="Microsoft Graph API"></a>Microsoft Graph API</h2><p>では、ここで同意された <code>User.Read</code> のスコープとはなんなのでしょうか。Microsoft Graph API の API のアクセス許可であることはご存じだと思いますが、これらのスコープはどこに定義されて、同意した権限はどのように保存されているのでしょうか。</p>
<h3 id="OAuthPermissionGrants-を確認する"><a href="#OAuthPermissionGrants-を確認する" class="headerlink" title="OAuthPermissionGrants を確認する"></a>OAuthPermissionGrants を確認する</h3><p>これを理解するためには、Azure AD に登録されたサービス プリンシパルについて確認することが必要です。</p>
<p>先ほど “アプリの登録” からアプリを作成したと思います。その際エンタープライズ アプリケーションも同時に作成されると言いましたが、このエンタープライズ アプリケーションこそがサービス プリンシパルと呼ばれるオブジェクトです。正確にはエンタープライズ アプリケーションがサービス プリンシパルの一種ですが基本的には “サービス プリンシパル” と “エンタープライズ アプリケーション” はほぼ同義だと考えて OK です。</p>
<p>テナントに登録された <a target="_blank" rel="noopener" href="https://docs.microsoft.com/ja-jp/graph/api/resources/serviceprincipal?view=graph-rest-1.0">“サービス プリンシパル” オブジェクト</a> の一覧は、Azure AD PowerShell モジュールや Microsoft Graph API で取得できます。<br>ここでは <a target="_blank" rel="noopener" href="https://github.com/microsoftgraph/msgraph-sdk-powershell">Microsoft Graph PowerShell SDK</a> を利用して、サービス プリンシパルの一覧を取得してみましょう。</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Install-Module</span> Microsoft.Graph</span><br><span class="line"><span class="built_in">Select-MgProfile</span> <span class="literal">-Name</span> <span class="string">&quot;v1.0&quot;</span></span><br></pre></td></tr></table></figure>

<p>OAuth の権限を取得するため、<code>Directory.Read.All</code> の権限が必要ですので、あらかじめ指定しておきます。この後の Connect-Graph 実行時にはテナントのグローバル管理者でのサインインが必要です。</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Connect-Graph</span> <span class="literal">-Scopes</span> Directory.Read.All</span><br><span class="line"><span class="comment"># To sign in, use a web browser to open the page https://microsoft.com/devicelogin and enter the code HMCYSET2L to authenticate. </span></span><br><span class="line"><span class="comment"># 注: URL にアクセスし、code を入力しグローバル管理者権限でサインインと同意を完了させます。</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Get-MgServicePrincipal</span> |<span class="built_in">Select-Object</span> AppDisplayName, Id, AppId</span><br><span class="line"></span><br><span class="line"><span class="comment"># AppDisplayName                          Id                                   AppId</span></span><br><span class="line"><span class="comment"># --------------                          --                                   -----</span></span><br><span class="line"><span class="comment"># Microsoft password reset service        11fc006f-2cb4-4f3c-9c43-c3a3d7f76184 93625bc8-bfe2-437a-97e0-3d0060024faa</span></span><br><span class="line"><span class="comment"># Office 365 Configure                    134ad4d8-2e42-46a6-8508-c9585c67b30f aa9ecb1e-fd53-4aaa-a8fe-7a54de2c1334</span></span><br><span class="line"><span class="comment"># Microsoft Graph                         19a9419c-cc6f-47c6-88f3-0f2a964a4f16 00000003-0000-0000-c000-000000000000</span></span><br><span class="line"><span class="comment"># Windows Azure Active Directory          29a26a86-d50a-4b2a-a40a-4c014aa9e416 00000002-0000-0000-c000-000000000000</span></span><br><span class="line"><span class="comment"># MS-PIM                                  2a71ba9d-de5b-4f9a-a9df-73e68bc5ddcf 01fc33a7-78ba-4d2f-a4b7-768e336e890e</span></span><br><span class="line"><span class="comment"># AAD Request Verification Service - PROD 3dd23bd7-8280-490f-984e-616873819772 c728155f-7b2a-4502-a08b-b8af9b269319</span></span><br><span class="line"><span class="comment"># MS Graph Client Sample                  439775c2-70a1-4e08-a3e7-cd39c50e918d 2d6aced0-40ae-4519-a2e5-8e23944fc046</span></span><br><span class="line"><span class="comment"># Windows Azure Service Management API    62fc0cd5-d157-4ee0-befb-877a367210e2 797f4846-ba00-4fd7-ba43-dac1f8f63013</span></span><br><span class="line"><span class="comment"># O365 Demeter                            96909691-743c-49e3-80d4-a5428bd47108 982bda36-4632-4165-a46a-9863b1bbcf7d</span></span><br><span class="line"><span class="comment"># Microsoft.Azure.SyncFabric              a6069499-077b-45a8-9fa2-ac9ca80c5df6 00000014-0000-0000-c000-000000000000</span></span><br><span class="line"><span class="comment"># Microsoft App Access Panel              a6eb38c8-78c9-47cd-981f-2136273824c3 0000000c-0000-0000-c000-000000000000</span></span><br><span class="line"><span class="comment"># Microsoft Graph PowerShell              b42a2cf1-3551-4e3a-bcd7-bf299f12cb3c 14d82eec-204b-4c2f-b7e8-296a70dab67e</span></span><br><span class="line"><span class="comment"># Microsoft.SMIT                          b8a15564-fd40-4802-b2e9-cd5a2ae6715b 8fca0a66-c008-4564-a876-ab3ae0fd5cff</span></span><br><span class="line"><span class="comment"># Azure ESTS Service                      c0a8c459-1611-4405-8f89-4008de7b7988 00000001-0000-0000-c000-000000000000</span></span><br><span class="line"><span class="comment"># Signup                                  c51b3541-6e7a-4aff-8582-729c8174f66d b4bddae8-ab25-483e-8670-df09b9f1d0ea</span></span><br><span class="line"><span class="comment"># Microsoft Graph Change Tracking         d3a24af2-a630-4c87-8d17-013aa3e576e1 0bf30f3b-4a52-48df-9a82-234910c4a086</span></span><br><span class="line"><span class="comment"># MCAPI Authorization Prod                d9c70c10-16ff-4021-a6dc-25916de5a7b9 d73f4b35-55c9-48c7-8b10-651f6f2acb2e</span></span><br><span class="line"><span class="comment"># IAM Supportability                      e2619bb6-17d5-47e4-93e5-4b8fd5a836dd a57aca87-cbc0-4f3c-8b9e-dc095fdc8978</span></span><br><span class="line"><span class="comment"># AzureSupportCenter                      e883ba61-437b-4b80-bee2-f3106fcb9221 37182072-3c9c-4f6a-a4b3-b3f91cacffce</span></span><br><span class="line"><span class="comment"># Azure Portal                            f131b178-6dda-4f79-9247-cc744d946491 c44b4083-3bb0-49c1-b47d-974e53cbdf3c</span></span><br></pre></td></tr></table></figure>

<p>このテナントはテスト用に作成したテナントなので、これだけしか出力されませんが、実際のテナントでは Microsoft が管理しているアプリや、サードパーティー製のアプリ、自社で開発しているアプリなど、大量に出力されると思います。<br>これらの多くのアプリケーションは Azure ポータルの <a target="_blank" rel="noopener" href="https://portal.azure.com/#blade/Microsoft_AAD_IAM/StartboardApplicationsMenuBlade/AllApps/menuId/">エンタープライズ アプリケーション</a> にも表示されていますが、Microsoft が管理されている一部のサービス プリンシパルはポータルに表示されないものもあります。</p>
<p>今回作成したアプリは <code>MS Graph Client Sample</code> ですので、当該のサービス プリンシパル取得しておきます。</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$myAppSp</span> = <span class="built_in">Get-MgServicePrincipal</span> <span class="literal">-Filter</span> <span class="string">&quot;displayName eq &#x27;MS Graph Client Sample&#x27;&quot;</span></span><br></pre></td></tr></table></figure>

<p>次に、先ほど同意を行った API のアクセス許可を取得します。API のアクセス許可は <a target="_blank" rel="noopener" href="https://docs.microsoft.com/ja-jp/graph/api/serviceprincipal-list-oauth2permissiongrants?view=graph-rest-1.0&tabs=http">OAuth2Permissions</a> として保存されているため、以下のコマンドで取得可能です。</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$oAuth2Permissions</span> = <span class="built_in">Get-MgServicePrincipalOauth2PermissionGrant</span> <span class="literal">-ServicePrincipalId</span> <span class="variable">$myAppSp</span>.Id</span><br><span class="line"><span class="variable">$oAuth2Permissions</span> | <span class="built_in">fl</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># ClientId             : 439775c2-70a1-4e08-a3e7-cd39c50e918d</span></span><br><span class="line"><span class="comment"># ConsentType          : Principal</span></span><br><span class="line"><span class="comment"># ExpiryTime           : 2021/05/28 4:12:42</span></span><br><span class="line"><span class="comment"># Id                   : wnWXQ6FwCE6j5805xQ6RjZxBqRlvzMZHiPMPKpZKTxZ1aL_h6m71R6v57ub13Wy-</span></span><br><span class="line"><span class="comment"># PrincipalId          : e1bf6875-6eea-47f5-abf9-eee6f5dd6cbe</span></span><br><span class="line"><span class="comment"># ResourceId           : 19a9419c-cc6f-47c6-88f3-0f2a964a4f16</span></span><br><span class="line"><span class="comment"># Scope                :  User.Read openid profile Mail.Read</span></span><br><span class="line"><span class="comment"># StartTime            : 0001/01/01 0:00:00</span></span><br><span class="line"><span class="comment"># Keys                 : &#123;&#125;</span></span><br><span class="line"><span class="comment"># Values               : &#123;&#125;</span></span><br><span class="line"><span class="comment"># AdditionalProperties : &#123;&#125;</span></span><br><span class="line"><span class="comment"># Count                : 0</span></span><br></pre></td></tr></table></figure>

<p>先ほどのサンプルで同意した API のアクセス許可である User.Read, openid, profile, Mail.Read が表示されています。<br>また PrincipalId は、先ほど同意処理を実施したユーザーの ObjectId であることが確認できます。</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-MgUser</span> <span class="literal">-UserId</span>  e1bf6875<span class="literal">-6eea</span><span class="literal">-47f5</span><span class="literal">-abf9</span><span class="literal">-eee6f5dd6cbe</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Id                                   DisplayName Mail UserPrincipalName                   UserType</span></span><br><span class="line"><span class="comment"># --                                   ----------- ---- -----------------                   --------</span></span><br><span class="line"><span class="comment"># e1bf6875-6eea-47f5-abf9-eee6f5dd6cbe user             user@oauth2beginner.onmicrosoft.com Member</span></span><br></pre></td></tr></table></figure>

<p>つまり、この情報から上記ユーザーが、”User.Read, openid, profile, Mail.Read” の権限を、クライアントであるサービス プリンシパル “439775c2-70a1-4e08-a3e7-cd39c50e918d” (MS Graph Client Sample) に委任した、ということが確認できます。<br>そして、それらの情報は <a target="_blank" rel="noopener" href="https://docs.microsoft.com/ja-jp/graph/api/resources/oauth2permissiongrant?view=graph-rest-1.0">OAuth2Permissions</a> として保存されていることがわかります。</p>
<p>さて、この API 権限 (OAuth2Permissions) ですがサンプルを動作させた皆様なら、”Microsoft Graph API” の権限であることはお分かりかと思います。<br>では、その情報はどこで確認できるのでしょうか。</p>
<p>OAuth2PermissionGrant の内容を確認すると ResourceId “19a9419c-cc6f-47c6-88f3-0f2a964a4f16” とあります。<br>この ResourceId を指定し、サービス プリンシパルを取得してみましょう。</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-MgServicePrincipal</span> <span class="literal">-ServicePrincipalId</span> <span class="number">19</span>a9419c<span class="literal">-cc6f</span><span class="literal">-47c6</span><span class="literal">-88f3</span><span class="literal">-0f2a964a4f16</span> | <span class="built_in">Select-Object</span> DisplayName, AppId</span><br><span class="line"></span><br><span class="line"><span class="comment"># DisplayName     AppId</span></span><br><span class="line"><span class="comment"># -----------     -----</span></span><br><span class="line"><span class="comment"># Microsoft Graph 00000003-0000-0000-c000-000000000000</span></span><br></pre></td></tr></table></figure>
<div class="alert is-info"><p class="alert-title">Note</p><p>※ 表示される ResourceId はテナントごとに異なります。</p></div>
<h3 id="リソースの正体"><a href="#リソースの正体" class="headerlink" title="リソースの正体"></a>リソースの正体</h3><p>当たり前といえば当たり前ですが、ResourceId が指示していたのは Microsoft Graph API でした。<br>そしてその正体は、テナントに登録されている “Microsoft Graph” という名前のサービス プリンシパルなのです。</p>
<p>実は Azure AD の “サービスプリンシパル” は、OAuth の文脈では “クライアント” を表すこともあれば、”リソース” を表すこともあります。(あるいはその両方を表すこともあります)<br>そして ResourceId に表示されている通り、Microsoft Graph は Azure AD に登録されたリソースとしてのサービス プリンシパルである、ということです。</p>
<p>それでは早速 Microsoft Graph API のリソースを表す、”Microsoft Graph” の “サービスプリンシパル” の中身を見てみましょう。<br>サービスプリンシパルは先ほどの ResourceId を指定するか、もしくは、Microsoft Graph の AppId は “00000003-0000-0000-c000-000000000000” と決まっているので、以下のようにフィルターしても OK です。</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$msGraph</span> = <span class="built_in">Get-MgServicePrincipal</span> <span class="literal">-Filter</span> <span class="string">&quot;appId eq &#x27;00000003-0000-0000-c000-000000000000&#x27;&quot;</span></span><br></pre></td></tr></table></figure>

<p>取得したサービス プリンシパルを確認してみましょう。</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$msGraph</span> | <span class="built_in">Format-List</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># AccountEnabled                     : True</span></span><br><span class="line"><span class="comment"># AddIns                             : &#123;&#125;</span></span><br><span class="line"><span class="comment"># AlternativeNames                   : &#123;&#125;</span></span><br><span class="line"><span class="comment"># AppDescription                     :</span></span><br><span class="line"><span class="comment"># AppDisplayName                     : Microsoft Graph</span></span><br><span class="line"><span class="comment"># AppId                              : 00000003-0000-0000-c000-000000000000</span></span><br><span class="line"><span class="comment"># AppOwnerOrganizationId             : f8cdef31-a31e-4b4a-93e4-5f571e91255a</span></span><br><span class="line"><span class="comment"># AppRoleAssignedTo                  :</span></span><br><span class="line"><span class="comment"># AppRoleAssignmentRequired          : False</span></span><br><span class="line"><span class="comment"># AppRoleAssignments                 :</span></span><br><span class="line"><span class="comment"># AppRoles                           : &#123;ba7b8302-40ad-475c-a768-5b990aa1dba1, 57f0b71b-a759-45a0-9a0f-cc099fbd9a44, 673cd</span></span><br><span class="line"><span class="comment">#                                      294-c6eb-43f7-8bc9-cee7da70d759, 107747da-618e-4e26-bcaf-6adac31d8dae...&#125;</span></span><br><span class="line"><span class="comment"># ApplicationTemplateId              :</span></span><br><span class="line"><span class="comment"># ClaimsMappingPolicies              :</span></span><br><span class="line"><span class="comment"># CreatedObjects                     :</span></span><br><span class="line"><span class="comment"># DeletedDateTime                    :</span></span><br><span class="line"><span class="comment"># Description                        :</span></span><br><span class="line"><span class="comment"># DisplayName                        : Microsoft Graph</span></span><br><span class="line"><span class="comment"># Endpoints                          :</span></span><br><span class="line"><span class="comment"># HomeRealmDiscoveryPolicies         :</span></span><br><span class="line"><span class="comment"># Homepage                           :</span></span><br><span class="line"><span class="comment"># Id                                 : 19a9419c-cc6f-47c6-88f3-0f2a964a4f16</span></span><br><span class="line"><span class="comment"># Info                               : Microsoft.Graph.PowerShell.Models.MicrosoftGraphInformationalUrl</span></span><br><span class="line"><span class="comment"># KeyCredentials                     : &#123;&#125;</span></span><br><span class="line"><span class="comment"># LoginUrl                           :</span></span><br><span class="line"><span class="comment"># LogoutUrl                          :</span></span><br><span class="line"><span class="comment"># MemberOf                           :</span></span><br><span class="line"><span class="comment"># Notes                              :</span></span><br><span class="line"><span class="comment"># NotificationEmailAddresses         : &#123;&#125;</span></span><br><span class="line"><span class="comment"># Oauth2PermissionGrants             :</span></span><br><span class="line"><span class="comment"># Oauth2PermissionScopes             : &#123;2884dbf9-deb7-4665-a380-2a5a11805f09, a4633e44-d355-4474-99df-8c2de6b0e39e, 3660b</span></span><br><span class="line"><span class="comment">#                                      e8e-a561-4754-bf45-278f6f4d38f3, ac0981dc-81a3-4a1d-af5b-d664bef4bbf7...&#125;</span></span><br><span class="line"><span class="comment"># OwnedObjects                       :</span></span><br><span class="line"><span class="comment"># Owners                             :</span></span><br><span class="line"><span class="comment"># PasswordCredentials                : &#123;&#125;</span></span><br><span class="line"><span class="comment"># PreferredSingleSignOnMode          :</span></span><br><span class="line"><span class="comment"># PreferredTokenSigningKeyThumbprint :</span></span><br><span class="line"><span class="comment"># ReplyUrls                          : &#123;&#125;</span></span><br><span class="line"><span class="comment"># SamlSingleSignOnSettings           : Microsoft.Graph.PowerShell.Models.MicrosoftGraphSamlSingleSignOnSettings</span></span><br><span class="line"><span class="comment"># ServicePrincipalNames              : &#123;00000003-0000-0000-c000-000000000000/ags.windows.net, 00000003-0000-0000-c000-000</span></span><br><span class="line"><span class="comment">#                                      000000000, https://canary.graph.microsoft.com, https://graph.microsoft.com...&#125;</span></span><br><span class="line"><span class="comment"># ServicePrincipalType               : Application</span></span><br><span class="line"><span class="comment"># Tags                               : &#123;&#125;</span></span><br><span class="line"><span class="comment"># TokenEncryptionKeyId               :</span></span><br><span class="line"><span class="comment"># TokenIssuancePolicies              :</span></span><br><span class="line"><span class="comment"># TokenLifetimePolicies              :</span></span><br><span class="line"><span class="comment"># TransitiveMemberOf                 :</span></span><br><span class="line"><span class="comment"># Keys                               : &#123;createdDateTime, resourceSpecificApplicationPermissions, signInAudience, verified</span></span><br><span class="line"><span class="comment">#                                      Publisher&#125;</span></span><br><span class="line"><span class="comment"># Values                             : &#123;2020-11-29T03:54:06Z, System.Object[], AzureADMultipleOrgs, System.Collections.Ge</span></span><br><span class="line"><span class="comment">#                                      neric.Dictionary`2[System.String,System.Object]&#125;</span></span><br><span class="line"><span class="comment"># AdditionalProperties               : &#123;[createdDateTime, 2020-11-29T03:54:06Z], [resourceSpecificApplicationPermissions,</span></span><br><span class="line"><span class="comment">#                                       System.Object[]], [signInAudience, AzureADMultipleOrgs], [verifiedPublisher, Syst</span></span><br><span class="line"><span class="comment">#                                      em.Collections.Generic.Dictionary`2[System.String,System.Object]]&#125;</span></span><br><span class="line"><span class="comment"># Count                              : 4</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>設定値がいくつか表示されますね。たとえば <code>PublisherName</code> は <code>Microsoft Services</code> で、<code>AppOwnerOrganizationId</code> が <code>f8cdef31-a31e-4b4a-93e4-5f571e91255a</code> であるので、Microsoft が管理しているサービス プリンシパルであると判別できます。</p>
<p>ここで今回注目すべきは <strong><a target="_blank" rel="noopener" href="https://docs.microsoft.com/ja-jp/graph/api/resources/permissionscope?view=graph-rest-1.0">Oauth2PermissionScopes</a></strong> です。<br>少し中身を確認してみましょう。</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$msGraph</span>.Oauth2PermissionScopes | <span class="built_in">Select-Object</span> Value, UserConsentDescription <span class="literal">-First</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Value                             UserConsentDescription</span></span><br><span class="line"><span class="comment"># -----                             ----------------------</span></span><br><span class="line"><span class="comment"># SensitiveInfoType.Read.All        Allow the app to get the list of available sensitive types, including out of box a...</span></span><br><span class="line"><span class="comment"># SensitivityLabel.Evaluate         Allow the app to determine if there is any sensitivity label to be applied automat...</span></span><br><span class="line"><span class="comment"># DataLossPreventionPolicy.Evaluate Allow the app to evaluate the inputs provided against the Data Loss Prevention pol...</span></span><br><span class="line"><span class="comment"># SensitiveInfoType.Detect          Allow the app to scan the text in the input to detect the sensitive information ty...</span></span><br><span class="line"><span class="comment"># APIConnectors.ReadWrite.All       Allows the app to read, create and manage the API connectors used in user authenti...</span></span><br><span class="line"><span class="comment"># APIConnectors.Read.All            Allows the app to read the API connectors used in user authentication flows, on yo...</span></span><br><span class="line"><span class="comment"># TeamsTab.ReadWriteForUser         Allows a Teams app to read, install, upgrade, and uninstall all tabs for you.</span></span><br><span class="line"><span class="comment"># TeamsTab.ReadWriteForTeam         Allows a Teams app to read, install, upgrade, and uninstall all tabs to teams you ...</span></span><br><span class="line"><span class="comment"># TeamsTab.ReadWriteForChat         Allows a Teams app to read, install, upgrade, and uninstall all tabs in chats you ...</span></span><br><span class="line"><span class="comment"># ChatMessage.Read                  Allows an app to read one-to-one or group chat messages in Microsoft Teams, on you...</span></span><br></pre></td></tr></table></figure>

<p>そうです、もうお分かりですね。Microsoft Graph API の scope 一覧は、この Oauth2PermissionScopes に定義されています。<br>ちなみに <code>User.Read</code> 権限は、ユーザーをアプリにサインインさせ、プロファイルを表示させる権限と定義されています。</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> <span class="variable">$msGraph</span>.Oauth2PermissionScopes | ?&#123; <span class="variable">$_</span>.Value <span class="operator">-eq</span> <span class="string">&quot;User.Read&quot;</span>&#125;  | <span class="built_in">Select-Object</span> Value, UserConsentDescription</span><br><span class="line"></span><br><span class="line">Value     UserConsentDescription</span><br><span class="line">-----     ----------------------</span><br><span class="line">User.Read Allows you to sign <span class="keyword">in</span> to the app with your organizational account and let the app read your profile. It al...</span><br></pre></td></tr></table></figure>

<p>Microsoft Graph API のアクセス許可の一覧は、<a target="_blank" rel="noopener" href="https://docs.microsoft.com/ja-jp/graph/permissions-reference">Microsoft Graph のアクセス許可のリファレンス - Microsoft Graph | Microsoft Docs</a> にあります。<br>ユーザー権限の API のアクセス許可、すなわち scope はこのうち委任されたアクセス許可に該当します。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/oauth-flow-4.png"></p>
<!-- 
API を呼び出す際の動作をブラウザーの開発者ツール (F12 で起動し、`See Profile` ボタンクリック時の通信を Network タブを確認します) で見てみると、アクセストークンの値を確認できます。あるいは JavaScript のデバッグ ツールで、トークンの値を確認してもよいでしょう。

Authorization ヘッダーに付与されたアクセス トークンの値をコピーし、[https://jwt.ms](https://jwt.ms) に張り付けると、トークンの scp (scope) として `Mail.Read` `openid` `profile` `User.Read` `email` が含まれていることが確認できます。

![](/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/user-delegated-access-token.png)

今回アプリ内で呼び出した、[ユーザーの取得 API](https://docs.microsoft.com/ja-jp/graph/api/user-get?view=graph-rest-1.0&tabs=http) は、最低限 `User.Read` のユーザー委任の権限が必要ですので、`User.Read` のスコープが含まれたアクセス トークンを提示すれば API にアクセスができるようになります。 -->

<h3 id="ユーザー委任の-API-のアクセス許可のまとめ"><a href="#ユーザー委任の-API-のアクセス許可のまとめ" class="headerlink" title="ユーザー委任の API のアクセス許可のまとめ"></a>ユーザー委任の API のアクセス許可のまとめ</h3><p>Microsoft Graph API をユーザー委任の権限で呼び出すアプリを実装しました。<br>アプリは scope と呼ばれる単位で、ユーザーに API のアクセス許可の同意を要求し、ユーザーが同意することでそれらのアクセス許可を委任されます。</p>
<p>ユーザーの同意済みスコープはエンタープライズ アプリケーション (サービス プリンシパル) に保存されますが、これらのスコープはもともと Microsoft Graph のサービス プリンシパルに OAuth2PermissionScopes として定義されています。<br>API の呼び出しに必要な scope を含むアクセス トークンを取得することで、Microsoft Graph API を呼び出すことができました。</p>
<h2 id="アプリケーションのアクセス許可"><a href="#アプリケーションのアクセス許可" class="headerlink" title="アプリケーションのアクセス許可"></a>アプリケーションのアクセス許可</h2><p>ここまではユーザー委任のアクセス許可について説明しましたが、アプリケーションのアクセス許可についても少し説明します。とはいえ、ユーザー委任の権限に比べるとシンプルです。</p>
<p>ユーザー委任の権限は、scope という単位で、アクセス時にユーザーに同意を求める動作でした。<br>それに対し、アプリケーションのアクセス許可はアプリの作成時に事前に定義を行います。</p>
<h3 id="アプリケーションを作成し、アクセス許可を付与する"><a href="#アプリケーションを作成し、アクセス許可を付与する" class="headerlink" title="アプリケーションを作成し、アクセス許可を付与する"></a>アプリケーションを作成し、アクセス許可を付与する</h3><p>アプリケーションのアクセス許可の付与方法については、以前ブログで <a target="_blank" rel="noopener" href="https://github.com/jpazureid/get-last-signin-reports/tree/use-signin-activity-beta-api">ユーザーの最終サインイン日時を取得するスクリプト</a> を紹介しましたので、こちらをサンプルとして利用します。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/app-oauth-flow.png"></p>
<p>上記サンプルでは、<code>User.Read.All</code> と <code>AuditLog.Read.All</code> のアプリケーションのアクセス許可をアプリに付与し、管理者の同意を実施していました。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/app-permissions.png"></p>
<p>そしてアプリは保存されたクライアント シークレットや証明書を利用し、Microsoft Graph API を呼び出すためのアクセス トークンを取得しています。</p>
<h3 id="アプリケーションの権限を付与することで何が起きたのか"><a href="#アプリケーションの権限を付与することで何が起きたのか" class="headerlink" title="アプリケーションの権限を付与することで何が起きたのか"></a>アプリケーションの権限を付与することで何が起きたのか</h3><p>先ほどと同様に、クライアントとして登録したアプリのサービス プリンシパルを確認してみましょう。<br>アクセス許可を確認すると、種類が Application となっており、クレームの値は User.Read.All となっています。また、付与方法が “管理者の同意” となっていることも確認できます。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/app-permissions-2.png"></p>
<p>つまり、今回も User.Read.All の scope に同意したということなのでしょうか。</p>
<p>先ほどと同じように、同意済みの scope を Get-MgOauth2PermissionGrant コマンドで確認してみましょう。</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$myAppSp</span> = <span class="built_in">Get-MgServicePrincipal</span> <span class="literal">-Filter</span> <span class="string">&quot;displayName eq &#x27;Get Last SignIn&#x27;&quot;</span></span><br><span class="line"><span class="variable">$oAuth2Permissions</span> = <span class="built_in">Get-MgServicePrincipalOauth2PermissionGrant</span> <span class="literal">-ServicePrincipalId</span> <span class="variable">$myAppSp</span>.Id</span><br><span class="line"><span class="variable">$oAuth2Permissions</span> | <span class="built_in">fl</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># ClientId             : 383b27b3-1525-4362-a92b-4ca0625ff497</span></span><br><span class="line"><span class="comment"># ConsentType          : AllPrincipals</span></span><br><span class="line"><span class="comment"># Id                   : syc7OCUVYkOpK0ygYl_0l5xBqRlvzMZHiPMPKpZKTxY</span></span><br><span class="line"><span class="comment"># PrincipalId          :</span></span><br><span class="line"><span class="comment"># ResourceId           : 19a9419c-cc6f-47c6-88f3-0f2a964a4f16</span></span><br><span class="line"><span class="comment"># Scope                : User.Read</span></span><br><span class="line"><span class="comment"># Keys                 : &#123;&#125;</span></span><br><span class="line"><span class="comment"># Values               : &#123;&#125;</span></span><br><span class="line"><span class="comment"># AdditionalProperties : &#123;&#125;</span></span><br><span class="line"><span class="comment"># Count                : 0</span></span><br></pre></td></tr></table></figure>

<p>残念ながら、デフォルトで設定されている <code>User.Read</code> ※ のユーザー権限のアクセス許可のみが表示されており、<code>User.Read.All</code> や <code>AuditLog.Read.All</code> のアクセス許可は見当たりません。</p>
<div class="alert is-info"><p class="alert-title">Note</p><p>※ デフォルトで設定されている <code>User.Read</code> のアクセス許可は、サインインログの取得に特に必要ない権限ですが特に削除の必要もないため削除しておりませんでした。ユーザー委任のアクセス許可にもこのように管理者の同意ができます。</p></div>
<h3 id="アプリケーション権限の正体"><a href="#アプリケーション権限の正体" class="headerlink" title="アプリケーション権限の正体"></a>アプリケーション権限の正体</h3><p>結論を述べると、アプリケーション権限の正体は scope ではありません。<br>アプリケーション権限のアクセス許可は AppRole であり、同意済みの権限は <a target="_blank" rel="noopener" href="https://docs.microsoft.com/ja-jp/graph/api/serviceprincipal-list-approleassignedto?view=graph-rest-1.0&tabs=http">AppRoleAssignments</a> と呼ばれ PowerShell だと以下のコマンドで取得できます。</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$appRoleAssignments</span> = <span class="built_in">Get-MgServicePrincipalAppRoleAssignment</span> <span class="literal">-ServicePrincipalId</span> <span class="variable">$myAppSp</span>.Id</span><br><span class="line"><span class="variable">$appRoleAssignments</span> | <span class="built_in">fl</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># AppRoleId            : df021288-bdef-4463-88db-98f22de89214</span></span><br><span class="line"><span class="comment"># CreatedDateTime      : 2020/11/29 13:11:35</span></span><br><span class="line"><span class="comment"># DeletedDateTime      :</span></span><br><span class="line"><span class="comment"># Id                   : syc7OCUVYkOpK0ygYl_0l4kLNbV1-qFJl5eXj-YK7xo</span></span><br><span class="line"><span class="comment"># PrincipalDisplayName : Get Last SignIn</span></span><br><span class="line"><span class="comment"># PrincipalId          : 383b27b3-1525-4362-a92b-4ca0625ff497</span></span><br><span class="line"><span class="comment"># PrincipalType        : ServicePrincipal</span></span><br><span class="line"><span class="comment"># ResourceDisplayName  : Microsoft Graph</span></span><br><span class="line"><span class="comment"># ResourceId           : 19a9419c-cc6f-47c6-88f3-0f2a964a4f16</span></span><br><span class="line"><span class="comment"># Keys                 : &#123;&#125;</span></span><br><span class="line"><span class="comment"># Values               : &#123;&#125;</span></span><br><span class="line"><span class="comment"># AdditionalProperties : &#123;&#125;</span></span><br><span class="line"><span class="comment"># Count                : 0</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># AppRoleId            : b0afded3-3588-46d8-8b3d-9842eff778da</span></span><br><span class="line"><span class="comment"># CreatedDateTime      : 2020/11/29 13:11:35</span></span><br><span class="line"><span class="comment"># DeletedDateTime      :</span></span><br><span class="line"><span class="comment"># Id                   : syc7OCUVYkOpK0ygYl_0l714yGEg10ZHlHTmMMwK0Cc</span></span><br><span class="line"><span class="comment"># PrincipalDisplayName : Get Last SignIn</span></span><br><span class="line"><span class="comment"># PrincipalId          : 383b27b3-1525-4362-a92b-4ca0625ff497</span></span><br><span class="line"><span class="comment"># PrincipalType        : ServicePrincipal</span></span><br><span class="line"><span class="comment"># ResourceDisplayName  : Microsoft Graph</span></span><br><span class="line"><span class="comment"># ResourceId           : 19a9419c-cc6f-47c6-88f3-0f2a964a4f16</span></span><br><span class="line"><span class="comment"># Keys                 : &#123;&#125;</span></span><br><span class="line"><span class="comment"># Values               : &#123;&#125;</span></span><br><span class="line"><span class="comment"># AdditionalProperties : &#123;&#125;</span></span><br><span class="line"><span class="comment"># Count                : 0</span></span><br></pre></td></tr></table></figure>

<p>先ほどと同じように、ResourceId <code>19a9419c-cc6f-47c6-88f3-0f2a964a4f16</code> の Microsoft Graph の権限が 2 つ現れました。<br>おそらくどちらかが <code>User.Read.All</code> で、どちらかが <code>AuditLog.Read</code> のはずなのですが、これらの情報からどうやって確認すればよいのでしょうか。</p>
<p>もちろん、これらの値は Microsoft Graph のサービス プリンシパルに定義されています。<br>具体的にアプリケーションの権限の API のアクセス許可は <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/graph/api/resources/approle?view=graph-rest-1.0">AppRole</a> として定義されています。</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$msGraph</span> = <span class="built_in">Get-MgServicePrincipal</span> <span class="literal">-ServicePrincipalId</span> <span class="number">19</span>a9419c<span class="literal">-cc6f</span><span class="literal">-47c6</span><span class="literal">-88f3</span><span class="literal">-0f2a964a4f16</span></span><br><span class="line"><span class="variable">$msGraph</span>.AppRoles| <span class="built_in">Select-Object</span> Value, Id, DisplayName <span class="literal">-First</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Value                             Id                                   DisplayName</span></span><br><span class="line"><span class="comment"># -----                             --                                   -----------</span></span><br><span class="line"><span class="comment"># DataLossPreventionPolicy.Evaluate ba7b8302-40ad-475c-a768-5b990aa1dba1 Evaluate Data Loss Prevention policy</span></span><br><span class="line"><span class="comment"># SensitivityLabel.Evaluate         57f0b71b-a759-45a0-9a0f-cc099fbd9a44 Evaluate sensitivity labels</span></span><br><span class="line"><span class="comment"># SensitiveInfoType.Detect          673cd294-c6eb-43f7-8bc9-cee7da70d759 Detect sensitive information types</span></span><br><span class="line"><span class="comment"># SensitiveInfoType.Read.All        107747da-618e-4e26-bcaf-6adac31d8dae Read available sensitive information types</span></span><br><span class="line"><span class="comment"># APIConnectors.ReadWrite.All       1dfe531a-24a6-4f1b-80f4-7a0dc5a0a171 Read and write API connectors for authenticat...</span></span><br><span class="line"><span class="comment"># APIConnectors.Read.All            b86848a7-d5b1-41eb-a9b4-54a4e6306e97 Read API connectors for authentication flows</span></span><br><span class="line"><span class="comment"># TeamsTab.ReadWriteForUser.All     425b4b59-d5af-45c8-832f-bb0b7402348a Allow the app to manage all tabs for all users</span></span><br><span class="line"><span class="comment"># TeamsTab.ReadWriteForTeam.All     6163d4f4-fbf8-43da-a7b4-060fe85ed148 Allow the Teams app to manage all tabs for al...</span></span><br><span class="line"><span class="comment"># TeamsTab.ReadWriteForChat.All     fd9ce730-a250-40dc-bd44-8dc8d20f39ea Allow the Teams app to manage all tabs for al...</span></span><br><span class="line"><span class="comment"># ChatMessage.Read.All              b9bb2381-47a4-46cd-aafb-00cb12f68504 Read all chat messages</span></span><br></pre></td></tr></table></figure>

<p>Id からアクセス許可の値を逆引きすると、アプリに割り当てられた AppRole の権限を確認することができます。</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$appRoleId</span> = <span class="variable">$appRoleAssignments</span> | %&#123; <span class="variable">$_</span>.AppRoleId &#125;</span><br><span class="line"><span class="variable">$msGraph</span>.AppRoles| ?&#123; <span class="variable">$appRoleId</span>.Contains(<span class="variable">$_</span>.Id) &#125; | <span class="built_in">Select-Object</span> Value, Id, DisplayName</span><br><span class="line"></span><br><span class="line"><span class="comment"># Value             Id                                   DisplayName</span></span><br><span class="line"><span class="comment"># -----             --                                   -----------</span></span><br><span class="line"><span class="comment"># AuditLog.Read.All b0afded3-3588-46d8-8b3d-9842eff778da Read all audit log data</span></span><br><span class="line"><span class="comment"># User.Read.All     df021288-bdef-4463-88db-98f22de89214 Read all users&#x27; full profiles</span></span><br></pre></td></tr></table></figure>

<!-- アクセス ログを取得するスクリプトの中で、アクセス トークンを出力し、[jwt.ms](https://jwt.ms) に張り付けると、roles (AppRoles) として、`User.Read.All` と `AuditLog.Read.All` が含まれていることが確認できます。

![](/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/app-access-token.png) -->

<h3 id="アプリケーション権限の-API-のアクセス許可まとめ"><a href="#アプリケーション権限の-API-のアクセス許可まとめ" class="headerlink" title="アプリケーション権限の API のアクセス許可まとめ"></a>アプリケーション権限の API のアクセス許可まとめ</h3><p>まとめると、アプリケーション権限のアクセス許可は、AppRole として定義されていることを確認しました。<br>アプリケーション オブジェクトに API のアクセス許可を設定し、管理者の同意を行うことでサービス プリンシパルに AppRoleAssignment として許可された API のアクセス許可が保存されます。</p>
<p>そしてアクセス トークンには roles として、API のアクセス許可が含まれ、Microsoft Graph API ではこのクレームをもとに、API アクセスを制御できることを確認しました。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/app-oauth-flow-2.png"></p>
<h2 id="Next-Step"><a href="#Next-Step" class="headerlink" title="Next Step"></a>Next Step</h2><p>ここまでは、Microsoft Graph API の scope と AppRole について解説をしてきましたが、Microsoft ID プラットフォームでは独自の API を作成し、Azure AD で保護することも可能です。</p>
<p>Azure AD 上にリソースとしてのアプリを登録し、scope や AppRole を定義することにより、自社の API を Azure AD の ID エコシステムを利用し保護することが可能です。つまり、Azure AD 上で特定のユーザーのみがアクセス可能なように制御したり、条件付きアクセスポリシーで不正なアクセスから保護するといったことが可能になります。</p>
<h3 id="サンプルアプリ"><a href="#サンプルアプリ" class="headerlink" title="サンプルアプリ"></a>サンプルアプリ</h3><p>Azure AD で API を保護するには、クライアント用のアプリに加え API 用のアプリを登録し、scope や AppRole を定義します。<br>クライアントでは MSAL ライブラリを利用し独自の API を呼び出すアクセス トークンを取得し、API 側では Microsoft.Identity や OWIN ライブラリなどを利用することにより、提示されたアクセス トークンを検証し、正規のトークンを所持するユーザー以外のアクセスをブロックすることが可能です。</p>
<p>具体的なサンプルは <a target="_blank" rel="noopener" href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/quickstart-v2-dotnet-native-aspnet">クイックスタート: Microsoft ID プラットフォームによって保護されている ASP.NET Web API を呼び出す</a> をご参照ください。また <a target="_blank" rel="noopener" href="https://github.com/Azure-Samples?q=webapi&type=&language=">各種言語のサンプル</a> は GitHub に公開されているか探してみてください。</p>
<p>今回は JavaScript の <a target="_blank" rel="noopener" href="https://github.com/Azure-Samples/active-directory-javascript-nodejs-webapi-v2">API サンプル</a>を動かし、先ほど作った MS Graph Client Sample から独自の API を呼び出してみます。<br>最終的な構成は以下のようなイメージです。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/api-diagram.png"></p>
<h3 id="アプリの登録"><a href="#アプリの登録" class="headerlink" title="アプリの登録"></a>アプリの登録</h3><p>まずはクライアント アプリ同様に、アプリの登録画面から API を登録します。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/api-registration.png"></p>
<h4 id="scope-の登録"><a href="#scope-の登録" class="headerlink" title="scope の登録"></a>scope の登録</h4><p>scope つまり、OAuth2Permissions つまり、ユーザー委任のアクセス許可は API の公開から登録します。<br>scope を登録するには、事前にアプリケーション ID の URI (Identifier) を設定します。これは OAuth の audience (aud)、リソースを表す識別子となります※。例えば Microsoft Graph API では “<a target="_blank" rel="noopener" href="https://graph.microsoft.com&quot;/">https://graph.microsoft.com&quot;</a> です。</p>
<p>この値はグローバルで一意である必要があり、初期設定では “api://appid” です。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/api-uri.png"></p>
<div class="alert is-info"><p class="alert-title">Note</p><p>※ アクセス トークン (V2) に含まれる aud の値はアプリケーション ID で固定です</p></div>
<p>スコープ名は Microsoft Graph API に倣って XXX.Read のように設定しましたがアプリの構成に従い好きな名前をつけて OK です。細かいスコープを切らない場合、Microsoft のサービスでは “user_impersonation” がよく利用されます。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/api-scope-create.png"></p>
<p><code>スコープの追加</code> をクリックすると、スコープが追加されます。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/api-scope.png"></p>
<p>scope を指定する際には、本来このアプリケーション ID の URI と scope の値を <code>/</code> でつなげて指定する必要があります。今回の例では “api://5a6e76a2-0790-4ca7-b42e-27b31d70aa92/Data.Read” が指定すべき scope の値になります。</p>
<div class="alert is-important"><p class="alert-title">重要</p><p>scope の指定時にアプリケーション ID の URI を省略すると暗黙的に “<a target="_blank" rel="noopener" href="https://graph.microsoft.com&quot;/">https://graph.microsoft.com&quot;</a> が指定されます。</p></div>
<h4 id="AppRole-の追加"><a href="#AppRole-の追加" class="headerlink" title="AppRole の追加"></a>AppRole の追加</h4><p>実は AppRole の設定は最近 Azure ポータルから行えるようになりました。<br><code>アプリのロール (プレビュー) </code> にアクセスし、<code>アプリ ロールの作成</code>をクリックします。</p>
<p>アプリケーションに付与できる権限を定義する場合には、<code>許可されたメンバーの種類</code> を “アプリケーション” か、”両方” を選択します。<br>なぜ、アプリケーション権限の実態である Role をユーザーに対しても割り当てられるんだと思われるかもしれませんが、実はアプリケーションの AppRole だけでなく、ユーザーの AppRole を Azure AD に定義することもできます。<a target="_blank" rel="noopener" href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/howto-add-app-roles-in-azure-ad-apps">アプリ ロールを追加してトークンから取得する</a> により詳細が記載されているので、ロールベースのアクセス許可を Azure AD で実現されたい方はご覧ください。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/api-role-create.png"></p>
<p>このように、AppRole についても Azure ポータルから設定が可能です。</p>
<p><code>マニフェスト</code> に移動し、後の動作確認のために accessTokenAcceptedVersion を 2 に設定し、保存します。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/api-manifest.png"></p>
<div class="alert is-info"><p class="alert-title">Note</p><p>トークンのバージョンについての詳細は <a target="_blank" rel="noopener" href="https://learn.microsoft.com/ja-jp/azure/active-directory/develop/access-tokens#token-formats">Microsoft ID プラットフォームのアクセス トークン - Microsoft Entra | Microsoft Learn</a> をご確認ください</p></div>
<h3 id="動作の確認-1"><a href="#動作の確認-1" class="headerlink" title="動作の確認"></a>動作の確認</h3><p>最後に、定義した API のアクセス許可の動作を確認してみます。</p>
<h4 id="クライアントの修正"><a href="#クライアントの修正" class="headerlink" title="クライアントの修正"></a>クライアントの修正</h4><p>まず自作の API を呼び出すためのアクセス トークンを取得します。アプリケーション権限の付与方法は、Graph API の場合と同じく、API のアクセス許可からアプリケーション権限の API を選択するだけですので省略します。</p>
<p>ユーザー権限のアクセス許可については、クイックスタートのサンプル (MS Graph Client Sample) を改造して呼び出しのイメージをつかんでみましょう。<br>いくつか修正点があるので順に説明します。</p>
<p>まずは、<code>authConfig.json</code> に <code>myAPITokenRequest</code> オブジェクトを作成しましょう。もともとの <code>tokenRequest</code> の scopes を “api://5a6e76a2-0790-4ca7-b42e-27b31d70aa92/Data.Read” に変更するだけです。</p>
<p>authConfig.json</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// my api token request</span></span><br><span class="line"><span class="keyword">const</span> myAPITokenRequest = &#123;</span><br><span class="line">    <span class="attr">scopes</span>: [<span class="string">&quot;api://5a6e76a2-0790-4ca7-b42e-27b31d70aa92/Data.Read&quot;</span>],</span><br><span class="line">    <span class="attr">forceRefresh</span>: <span class="literal">false</span> <span class="comment">// Set this to &quot;true&quot; to skip a cached token and go to the server to get a new token</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>API 呼び出し部分は、callMSGraph メソッドを流用し、<code>http://localhot:5000/api</code> を呼び出します。</p>
<p>authPopup.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callMyAPI</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    getTokenPopup(myAPITokenRequest).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">        callMSGraph(<span class="string">&quot;http://localhost:5000/api&quot;</span>, response.accessToken, updateUI);</span><br><span class="line">    &#125;).catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(error);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ui.js と index.html にもコードを追加します。</p>
<p>ui.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (endpoint === graphConfig.graphMeEndpoint) &#123;</span><br><span class="line">    <span class="keyword">const</span> title = <span class="built_in">document</span>.createElement(<span class="string">&#x27;p&#x27;</span>);</span><br><span class="line">    title.innerHTML = <span class="string">&quot;&lt;strong&gt;Title: &lt;/strong&gt;&quot;</span> + data.jobTitle;</span><br><span class="line">    <span class="keyword">const</span> email = <span class="built_in">document</span>.createElement(<span class="string">&#x27;p&#x27;</span>);</span><br><span class="line">    email.innerHTML = <span class="string">&quot;&lt;strong&gt;Mail: &lt;/strong&gt;&quot;</span> + data.mail;</span><br><span class="line">    <span class="keyword">const</span> phone = <span class="built_in">document</span>.createElement(<span class="string">&#x27;p&#x27;</span>);</span><br><span class="line">    phone.innerHTML = <span class="string">&quot;&lt;strong&gt;Phone: &lt;/strong&gt;&quot;</span> + data.businessPhones[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">const</span> address = <span class="built_in">document</span>.createElement(<span class="string">&#x27;p&#x27;</span>);</span><br><span class="line">    address.innerHTML = <span class="string">&quot;&lt;strong&gt;Location: &lt;/strong&gt;&quot;</span> + data.officeLocation;</span><br><span class="line">    profileDiv.appendChild(title);</span><br><span class="line">    profileDiv.appendChild(email);</span><br><span class="line">    profileDiv.appendChild(phone);</span><br><span class="line">    profileDiv.appendChild(address);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (endpoint === graphConfig.graphMailEndpoint) &#123;</span><br><span class="line">    <span class="keyword">if</span> (data.value.length &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        alert(<span class="string">&quot;Your mailbox is empty!&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> tabList = <span class="built_in">document</span>.getElementById(<span class="string">&quot;list-tab&quot;</span>);</span><br><span class="line">        tabList.innerHTML = <span class="string">&#x27;&#x27;</span>; <span class="comment">// clear tabList at each readMail call</span></span><br><span class="line">        <span class="keyword">const</span> tabContent = <span class="built_in">document</span>.getElementById(<span class="string">&quot;nav-tabContent&quot;</span>);</span><br><span class="line"></span><br><span class="line">        data.value.map(<span class="function">(<span class="params">d, i</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// Keeping it simple</span></span><br><span class="line">            <span class="keyword">if</span> (i &lt; <span class="number">10</span>) &#123;</span><br><span class="line">                <span class="keyword">const</span> listItem = <span class="built_in">document</span>.createElement(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">                listItem.setAttribute(<span class="string">&quot;class&quot;</span>, <span class="string">&quot;list-group-item list-group-item-action&quot;</span>)</span><br><span class="line">                listItem.setAttribute(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;list&quot;</span> + i + <span class="string">&quot;list&quot;</span>)</span><br><span class="line">                listItem.setAttribute(<span class="string">&quot;data-toggle&quot;</span>, <span class="string">&quot;list&quot;</span>)</span><br><span class="line">                listItem.setAttribute(<span class="string">&quot;href&quot;</span>, <span class="string">&quot;#list&quot;</span> + i)</span><br><span class="line">                listItem.setAttribute(<span class="string">&quot;role&quot;</span>, <span class="string">&quot;tab&quot;</span>)</span><br><span class="line">                listItem.setAttribute(<span class="string">&quot;aria-controls&quot;</span>, i)</span><br><span class="line">                listItem.innerHTML = d.subject;</span><br><span class="line">                tabList.appendChild(listItem)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">const</span> contentItem = <span class="built_in">document</span>.createElement(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">                contentItem.setAttribute(<span class="string">&quot;class&quot;</span>, <span class="string">&quot;tab-pane fade&quot;</span>)</span><br><span class="line">                contentItem.setAttribute(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;list&quot;</span> + i)</span><br><span class="line">                contentItem.setAttribute(<span class="string">&quot;role&quot;</span>, <span class="string">&quot;tabpanel&quot;</span>)</span><br><span class="line">                contentItem.setAttribute(<span class="string">&quot;aria-labelledby&quot;</span>, <span class="string">&quot;list&quot;</span> + i + <span class="string">&quot;list&quot;</span>)</span><br><span class="line">                contentItem.innerHTML = <span class="string">&quot;&lt;strong&gt; from: &quot;</span> + d.from.emailAddress.address + <span class="string">&quot;&lt;/strong&gt;&lt;br&gt;&lt;br&gt;&quot;</span> + d.bodyPreview + <span class="string">&quot;...&quot;</span>;</span><br><span class="line">                tabContent.appendChild(contentItem);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//追加</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>(endpoint === <span class="string">&quot;http://localhost:5000/api&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> apiResponseDiv = <span class="built_in">document</span>.getElementById(<span class="string">&quot;api-response-div&quot;</span>);</span><br><span class="line">    apiResponseDiv.innerHTML = <span class="built_in">JSON</span>.stringify(data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>index.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span> <span class="attr">id</span>=<span class="string">&quot;seeProfile&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;seeProfile()&quot;</span>&gt;</span>See Profile<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span> <span class="attr">id</span>=<span class="string">&quot;readMail&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;readMail()&quot;</span>&gt;</span>Read Mails<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span> <span class="attr">id</span>=<span class="string">&quot;callMyAPI&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;callMyAPI()&quot;</span>&gt;</span>Call MyAPI<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;api-response-div&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>これでクライアント部分の実装は終了です。</p>
<h4 id="API-の実装"><a href="#API-の実装" class="headerlink" title="API の実装"></a>API の実装</h4><p>API では提示されたトークンが正規のものか、署名を検証し、必要なクレームの値 (例えば aud など) が含まれているかを検証する必要があります。<br>定義した API を保護するためのサンプルとしては、JavaScript の Passport を利用した以下のものを利用します。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/Azure-Samples/active-directory-javascript-nodejs-webapi-v2">Azure-Samples/active-directory-javascript-nodejs-webapi-v2: A small Node.js Web API that is protected with Azure AD v2.0 to validate access tokens and accepts authorized calls.</a></li>
</ul>
<p>config.json を以下のように修正します。</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;credentials&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;tenantID&quot;</span>: <span class="string">&quot;cae9d4b9-9fba-4add-9257-2bb9473a060f&quot;</span>, <span class="comment">//テナント ID</span></span><br><span class="line">    <span class="attr">&quot;clientID&quot;</span>: <span class="string">&quot;2d6aced0-40ae-4519-a2e5-8e23944fc046&quot;</span>, <span class="comment">//MS Graph Client Sample のアプリケーション ID</span></span><br><span class="line">    <span class="attr">&quot;audience&quot;</span>: <span class="string">&quot;5a6e76a2-0790-4ca7-b42e-27b31d70aa92&quot;</span> <span class="comment">//My API Sample のアプリケーション ID</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;resource&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;scope&quot;</span>: [<span class="string">&quot;Data.Read&quot;</span>] <span class="comment">//My API で作成した scope の値</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>修正後、以下のコマンドで API を起動します。正常に起動できれば <a target="_blank" rel="noopener" href="http://localhost:5000/">http://localhost:5000</a> で API サーバーが動き出します。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm install</span><br><span class="line">npm start</span><br></pre></td></tr></table></figure>

<h4 id="動作確認"><a href="#動作確認" class="headerlink" title="動作確認"></a>動作確認</h4><p>最後に <a target="_blank" rel="noopener" href="http://localhost:3000/">http://localhost:3000</a> にアクセスして、アプリにサインインしましょう。<code>Call MyAPI</code> をクリックすると先ほど定義した scope に同意するよう求められます。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/api-consent.png"></p>
<p>承諾をクリックすると、<code>http://localhost:5000/api</code> の API を呼び出すためのトークンが取得され、無事 API を呼び出すことに成功します。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/api-response.png"></p>
<p>最終的な構成はこのようなイメージです。</p>
<p><img src="/blog/azure-active-directory/oauth2-application-resource-and-api-permissions/api-diagram-detail.png"></p>
<h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>今回は Microsoft Graph API を呼び出すサンプルと、独自の API を定義することで、Azure AD 上で OAuth の scope や AppRole の定義方法やその実体を見てみました。チュートリアルをこなすだけでは見えてこない詳細なイメージがつかめたのではないでしょうか。</p>
<p>スコープや AppRole について理解することは、独自のアプリを実装するときだけでなく Microsoft が提供する API を利用する際にも非常に役に立つと思います。</p>
<p>さらに、独自のアプリを実装するに当たっては、<a target="_blank" rel="noopener" href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/single-and-multi-tenant-apps">Azure AD のシングルテナント アプリとマルチテナント アプリ</a> の違いを理解したり、Microsoft が推奨する<a target="_blank" rel="noopener" href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/identity-platform-integration-checklist">ベストプラクティスのチェックリスト</a>を確認したりするのがよいと思います。</p>
<p>皆様もぜひ、Azure AD を利用したセキュアなアプリ開発を実践してみてください。</p>

      
      
        <div class="article-disclaimer">
        
          <p>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>
        
        </div>
      
    </div>
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/Azure-AD/" rel="tag">Azure AD</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/OAuth/" rel="tag">OAuth</a></li></ul>

        
        <a href="https://github.com/jpazureid/blog/edit/main/articles/azure-active-directory/oauth2-application-resource-and-api-permissions.md" class="article-github-edit-link" target="_blank" rel="noopener noreferrer">GitHub で編集</a>
        
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../WorkPlaceJoin/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">次の記事</strong>
      <div class="article-nav-title">
        
          すべてのアプリにサインインしたままにする 
        
      </div>
    </a>
  
  
    <a href="../20200928-rca-azure-ad/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前の記事</strong>
      <div class="article-nav-title">9/28 (日本語抄訳) RCA – 複数の Microsoft サービスおよび Azure Active Directory と連携したアプリケーションでの認証エラー (Tracking ID SM79-F88)</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最近の投稿</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../microsoft-entra-private-access-for-on-prem-users/">オンプレミス ユーザー向けの Microsoft Entra プライベート アクセス</a>
          </li>
        
          <li>
            <a href="../how-to-deploy-cloud-kerberos-trust/">クラウド Kerberos 信頼デプロイ方法</a>
          </li>
        
          <li>
            <a href="../lifecycle-workflow/">ライフサイクル ワークフローを利用した簡易人事システムの紹介</a>
          </li>
        
          <li>
            <a href="../mto-ga/">マルチテナント組織 (MTO) が一般公開されました！</a>
          </li>
        
          <li>
            <a href="../tenant-health-transparency-and-observability/">テナントの正常性に関する透明性と可視化</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">タグ</h3>
    <div class="widget">
      <!-- <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="../../tags/80090016/" rel="tag">80090016</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/80090030/" rel="tag">80090030</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/AAD-Connect/" rel="tag">AAD Connect</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/AADSTS50107/" rel="tag">AADSTS50107</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/AD-FS/" rel="tag">AD FS</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/AD-Sync/" rel="tag">AD Sync</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/ADSync/" rel="tag">ADSync</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Access-Package/" rel="tag">Access Package</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Access-Review/" rel="tag">Access Review</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Access-review/" rel="tag">Access review</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Android/" rel="tag">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/App-Service/" rel="tag">App Service</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Application/" rel="tag">Application</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Audit-Logs/" rel="tag">Audit Logs</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Azure-AD/" rel="tag">Azure AD</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Azure-AD-Application-Proxy/" rel="tag">Azure AD Application Proxy</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Azure-AD-B2B/" rel="tag">Azure AD B2B</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Azure-AD-B2C/" rel="tag">Azure AD B2C</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Azure-AD-Connect/" rel="tag">Azure AD Connect</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Azure-AD-Directory-Rolls/" rel="tag">Azure AD Directory Rolls</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Azure-AD-Domain-Services/" rel="tag">Azure AD Domain Services</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Azure-AD-Join/" rel="tag">Azure AD Join</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Azure-AD-License/" rel="tag">Azure AD License</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Azure-AD-Rename-ROllout/" rel="tag">Azure AD Rename ROllout</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Azure-Ad-Connect/" rel="tag">Azure Ad Connect</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/B2B/" rel="tag">B2B</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/CBA/" rel="tag">CBA</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Client-Secrets/" rel="tag">Client Secrets</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Cloud-Kerberos-Trust/" rel="tag">Cloud Kerberos Trust</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Company-Branding/" rel="tag">Company Branding</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Compliant/" rel="tag">Compliant</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Conditional-Access/" rel="tag">Conditional Access</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Conditional-Access-Policy/" rel="tag">Conditional Access Policy</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Cross-Tenat-Synchronization/" rel="tag">Cross-Tenat Synchronization</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Device/" rel="tag">Device</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/DirSync/" rel="tag">DirSync</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Directory-Synchronization-Accounts/" rel="tag">Directory Synchronization Accounts</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Entitlement-Management/" rel="tag">Entitlement Management</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Entra-ID/" rel="tag">Entra ID</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/ExpressRoute/" rel="tag">ExpressRoute</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Federated-Domain/" rel="tag">Federated Domain</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Federation/" rel="tag">Federation</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Global-Secure-Access/" rel="tag">Global Secure Access</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/HAADJ/" rel="tag">HAADJ</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Hard-match/" rel="tag">Hard match</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Hybrid-Azure-AD-Join/" rel="tag">Hybrid Azure AD Join</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Identity-Governance/" rel="tag">Identity Governance</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Identity-Protection/" rel="tag">Identity Protection</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Intune/" rel="tag">Intune</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Issuer-ID/" rel="tag">Issuer ID</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Issuer-URI/" rel="tag">Issuer URI</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Key-Vault/" rel="tag">Key Vault</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Legacy-Authentication/" rel="tag">Legacy Authentication</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Lifecycle-Workflow/" rel="tag">Lifecycle Workflow</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Lifecycle-Workflows/" rel="tag">Lifecycle Workflows</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Limitation/" rel="tag">Limitation</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/MFA/" rel="tag">MFA</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Managed-Domain/" rel="tag">Managed Domain</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Managed-ID/" rel="tag">Managed ID</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Microsoft-Authenticator/" rel="tag">Microsoft Authenticator</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Microsoft-Authenticator-%E3%82%A2%E3%83%97%E3%83%AA/" rel="tag">Microsoft Authenticator アプリ</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Microsoft-Entra/" rel="tag">Microsoft Entra</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Microsoft-Entra-ID/" rel="tag">Microsoft Entra ID</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Microsoft-Entra-Join/" rel="tag">Microsoft Entra Join</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Microsoft-Entra-hybrid-join/" rel="tag">Microsoft Entra hybrid join</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Microsoft-Graph/" rel="tag">Microsoft Graph</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Microsoft-Graph-PowerShell/" rel="tag">Microsoft Graph PowerShell</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Microsoft-Graph-PowerShell-SDK/" rel="tag">Microsoft Graph PowerShell SDK</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Multi-Factor-Authentication/" rel="tag">Multi Factor Authentication</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Multi-Tenant-Organization/" rel="tag">Multi Tenant Organization</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Network/" rel="tag">Network</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/OAuth/" rel="tag">OAuth</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/OTP/" rel="tag">OTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/PIM/" rel="tag">PIM</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/PIN/" rel="tag">PIN</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/PRT/" rel="tag">PRT</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Password-Policy/" rel="tag">Password Policy</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Password-Writeback/" rel="tag">Password Writeback</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/PowerShell/" rel="tag">PowerShell</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Primary-Refresh-Token/" rel="tag">Primary Refresh Token</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Provisioning/" rel="tag">Provisioning</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/RBAC/" rel="tag">RBAC</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Role-Management/" rel="tag">Role Management</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/SAML/" rel="tag">SAML</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/SMTP/" rel="tag">SMTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/SSO/" rel="tag">SSO</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/SSPR/" rel="tag">SSPR</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/SameSite/" rel="tag">SameSite</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Security/" rel="tag">Security</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Security-Default/" rel="tag">Security Default</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Self-Service-Password-Reset/" rel="tag">Self Service Password Reset</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Service-Principal/" rel="tag">Service Principal</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Signin-Logs/" rel="tag">Signin Logs</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Smart-lockout/" rel="tag">Smart lockout</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Soft-matching/" rel="tag">Soft matching</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Staged-Rollout/" rel="tag">Staged Rollout</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Subscription/" rel="tag">Subscription</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/TLS-1-2/" rel="tag">TLS 1.2</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/TPM/" rel="tag">TPM</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Tenant-Restrictions/" rel="tag">Tenant Restrictions</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Token/" rel="tag">Token</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Troubleshooting/" rel="tag">Troubleshooting</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Trusted-Platform-Module/" rel="tag">Trusted Platform Module</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/UPN/" rel="tag">UPN</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/US-Identity-Blog/" rel="tag">US Identity Blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Verified-ID/" rel="tag">Verified ID</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/WAP/" rel="tag">WAP</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/WHfB/" rel="tag">WHfB</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Windows-10/" rel="tag">Windows 10</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Windows-Defender-ATP/" rel="tag">Windows Defender ATP</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Windows-Hello-for-Business/" rel="tag">Windows Hello for Business</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/WorkPlace-Join/" rel="tag">WorkPlace Join</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Workplace-Join/" rel="tag">Workplace Join</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/XTAP/" rel="tag">XTAP</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Zero-Trust/" rel="tag">Zero Trust</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/graph-api/" rel="tag">graph api</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/signin-log/" rel="tag">signin log</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/supportMultipleDomain/" rel="tag">supportMultipleDomain</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/unusual-sign-in/" rel="tag">unusual sign-in</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/%E3%82%AF%E3%83%AC%E3%83%BC%E3%83%A0%E3%83%AB%E3%83%BC%E3%83%AB/" rel="tag">クレームルール</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/%E3%83%86%E3%83%8A%E3%83%B3%E3%83%88%E5%88%B6%E9%99%90/" rel="tag">テナント制限</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/%E3%83%88%E3%83%A9%E3%82%B9%E3%83%86%E3%83%83%E3%83%89-%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0-%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB/" rel="tag">トラステッド プラットフォーム モジュール</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/" rel="tag">トラブルシューティング</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/%E3%83%AD%E3%82%B0%E5%8F%96%E5%BE%97/" rel="tag">ログ取得</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/%E6%83%85%E5%A0%B1%E6%8E%A1%E5%8F%96/" rel="tag">情報採取</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/%E6%9D%A1%E4%BB%B6%E4%BB%98%E3%81%8D%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9/" rel="tag">条件付きアクセス</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/%E8%A8%BC%E6%98%8E%E6%9B%B8/" rel="tag">証明書</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/%E8%A8%BC%E6%98%8E%E6%9B%B8%E8%AA%8D%E8%A8%BC/" rel="tag">証明書認証</a></li></ul>  -->
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="../../tags/AD-FS/">AD FS</a><span class="tag-list-count">23</span><ul><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AD-FS/AADSTS50107">AADSTS50107</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AD-FS/Azure-AD">Azure AD</a><span class="tag-list-count">7</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AD-FS/Azure-AD-Connect">Azure AD Connect</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AD-FS/CBA">CBA</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AD-FS/Conditional-Access">Conditional Access</a><span class="tag-list-count">3</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AD-FS/Federated-Domain">Federated Domain</a><span class="tag-list-count">2</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AD-FS/Hybrid-Azure-AD-Join">Hybrid Azure AD Join</a><span class="tag-list-count">3</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AD-FS/Intune">Intune</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AD-FS/Issuer-ID">Issuer ID</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AD-FS/Issuer-URI">Issuer URI</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AD-FS/MFA">MFA</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AD-FS/Managed-Domain">Managed Domain</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AD-FS/SameSite">SameSite</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AD-FS/Security">Security</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AD-FS/Smart-lockout">Smart lockout</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AD-FS/WAP">WAP</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AD-FS/Workplace-Join">Workplace Join</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AD-FS/supportMultipleDomain">supportMultipleDomain</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AD-FS/%E3%82%AF%E3%83%AC%E3%83%BC%E3%83%A0%E3%83%AB%E3%83%BC%E3%83%AB">クレームルール</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AD-FS/%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0">トラブルシューティング</a><span class="tag-list-count">2</span></li></ul></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Azure-AD/">Azure AD</a><span class="tag-list-count">280</span><ul><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/Azure-AD/80090016">80090016</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/Azure-AD/80090030">80090030</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/Azure-AD/AD-FS">AD FS</a><span class="tag-list-count">7</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/Azure-AD/Access-Package">Access Package</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/Azure-AD/Access-Review">Access Review</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/Azure-AD/Access-review">Access review</a><span class="tag-list-count">4</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/Azure-AD/App-Service">App Service</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/Azure-AD/Application">Application</a><span class="tag-list-count">8</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/Azure-AD/Audit-Logs">Audit Logs</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/Azure-AD/Azure-AD-Application-Proxy">Azure AD Application Proxy</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/Azure-AD/Azure-AD-B2B">Azure AD B2B</a><span class="tag-list-count">3</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/Azure-AD/Azure-AD-B2C">Azure AD B2C</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/Azure-AD/Azure-AD-Connect">Azure AD Connect</a><span class="tag-list-count">5</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/Azure-AD/Azure-AD-Domain-Services">Azure AD Domain Services</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/Azure-AD/Azure-AD-Join">Azure AD Join</a><span class="tag-list-count">2</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/Azure-AD/B2B">B2B</a><span class="tag-list-count">4</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/Azure-AD/Client-Secrets">Client Secrets</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/Azure-AD/Cloud-Kerberos-Trust">Cloud Kerberos Trust</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/Azure-AD/Compliant">Compliant</a><span class="tag-list-count">2</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/Azure-AD/Conditional-Access">Conditional Access</a><span class="tag-list-count">23</span></li></ul></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/AAD-Connect/">AAD Connect</a><span class="tag-list-count">17</span><ul><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AAD-Connect/AD-Sync">AD Sync</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AAD-Connect/ADSync">ADSync</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AAD-Connect/DirSync">DirSync</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AAD-Connect/SMTP">SMTP</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AAD-Connect/SSO">SSO</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AAD-Connect/Soft-matching">Soft matching</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/AAD-Connect/UPN">UPN</a><span class="tag-list-count">1</span></li></ul></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/%E6%83%85%E5%A0%B1%E6%8E%A1%E5%8F%96/">情報採取</a><span class="tag-list-count">2</span><ul><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/%E6%83%85%E5%A0%B1%E6%8E%A1%E5%8F%96/Azure-AD">Azure AD</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/%E6%83%85%E5%A0%B1%E6%8E%A1%E5%8F%96/Azure-AD-Connect">Azure AD Connect</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/%E6%83%85%E5%A0%B1%E6%8E%A1%E5%8F%96/Key-Vault">Key Vault</a><span class="tag-list-count">1</span></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">アーカイブ</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2024/06/">2024 / 06</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2024/05/">2024 / 05</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2024/04/">2024 / 04</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2024/03/">2024 / 03</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2024/02/">2024 / 02</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2024/01/">2024 / 01</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2023/12/">2023 / 12</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2023/11/">2023 / 11</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2023/10/">2023 / 10</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2023/09/">2023 / 09</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2023/08/">2023 / 08</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2023/07/">2023 / 07</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2023/06/">2023 / 06</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2023/05/">2023 / 05</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2023/04/">2023 / 04</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2023/03/">2023 / 03</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2023/02/">2023 / 02</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2023/01/">2023 / 01</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2022/12/">2022 / 12</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2022/11/">2022 / 11</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2022/10/">2022 / 10</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2022/09/">2022 / 09</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2022/08/">2022 / 08</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2022/07/">2022 / 07</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2022/06/">2022 / 06</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2022/05/">2022 / 05</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2022/04/">2022 / 04</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2022/03/">2022 / 03</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2022/02/">2022 / 02</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2022/01/">2022 / 01</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2021/12/">2021 / 12</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2021/11/">2021 / 11</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2021/10/">2021 / 10</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2021/09/">2021 / 09</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2021/08/">2021 / 08</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2021/07/">2021 / 07</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2021/06/">2021 / 06</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2021/05/">2021 / 05</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2021/04/">2021 / 04</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2021/03/">2021 / 03</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2021/02/">2021 / 02</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2021/01/">2021 / 01</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2020/12/">2020 / 12</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2020/10/">2020 / 10</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2020/09/">2020 / 09</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2020/08/">2020 / 08</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2020/07/">2020 / 07</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2020/06/">2020 / 06</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2020/05/">2020 / 05</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2020/04/">2020 / 04</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2020/03/">2020 / 03</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2020/02/">2020 / 02</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2020/01/">2020 / 01</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2019/12/">2019 / 12</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2019/11/">2019 / 11</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2019/10/">2019 / 10</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2019/09/">2019 / 09</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2019/07/">2019 / 07</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2019/05/">2019 / 05</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2019/02/">2019 / 02</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2018/12/">2018 / 12</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2018/11/">2018 / 11</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2018/10/">2018 / 10</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2018/09/">2018 / 09</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2018/08/">2018 / 08</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2018/07/">2018 / 07</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2018/06/">2018 / 06</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2018/05/">2018 / 05</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2018/04/">2018 / 04</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2018/03/">2018 / 03</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2018/02/">2018 / 02</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2018/01/">2018 / 01</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2017/12/">2017 / 12</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2017/11/">2017 / 11</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2017/10/">2017 / 10</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2017/06/">2017 / 06</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">タグクラウド</h3>
    <div class="widget tagcloud">
      <a href="../../tags/80090016/" style="font-size: 10px;">80090016</a> <a href="../../tags/80090030/" style="font-size: 10px;">80090030</a> <a href="../../tags/AAD-Connect/" style="font-size: 16.88px;">AAD Connect</a> <a href="../../tags/AADSTS50107/" style="font-size: 10px;">AADSTS50107</a> <a href="../../tags/AD-FS/" style="font-size: 18.13px;">AD FS</a> <a href="../../tags/AD-Sync/" style="font-size: 10px;">AD Sync</a> <a href="../../tags/ADSync/" style="font-size: 10px;">ADSync</a> <a href="../../tags/Access-Package/" style="font-size: 10.63px;">Access Package</a> <a href="../../tags/Access-Review/" style="font-size: 10.63px;">Access Review</a> <a href="../../tags/Access-review/" style="font-size: 11.88px;">Access review</a> <a href="../../tags/Android/" style="font-size: 10px;">Android</a> <a href="../../tags/App-Service/" style="font-size: 10px;">App Service</a> <a href="../../tags/Application/" style="font-size: 14.38px;">Application</a> <a href="../../tags/Audit-Logs/" style="font-size: 10px;">Audit Logs</a> <a href="../../tags/Azure-AD/" style="font-size: 20px;">Azure AD</a> <a href="../../tags/Azure-AD-Application-Proxy/" style="font-size: 10px;">Azure AD Application Proxy</a> <a href="../../tags/Azure-AD-B2B/" style="font-size: 14.38px;">Azure AD B2B</a> <a href="../../tags/Azure-AD-B2C/" style="font-size: 11.25px;">Azure AD B2C</a> <a href="../../tags/Azure-AD-Connect/" style="font-size: 16.25px;">Azure AD Connect</a> <a href="../../tags/Azure-AD-Directory-Rolls/" style="font-size: 10px;">Azure AD Directory Rolls</a> <a href="../../tags/Azure-AD-Domain-Services/" style="font-size: 10px;">Azure AD Domain Services</a> <a href="../../tags/Azure-AD-Join/" style="font-size: 10.63px;">Azure AD Join</a> <a href="../../tags/Azure-AD-License/" style="font-size: 10px;">Azure AD License</a> <a href="../../tags/Azure-AD-Rename-ROllout/" style="font-size: 10px;">Azure AD Rename ROllout</a> <a href="../../tags/Azure-Ad-Connect/" style="font-size: 10px;">Azure Ad Connect</a> <a href="../../tags/B2B/" style="font-size: 13.13px;">B2B</a> <a href="../../tags/CBA/" style="font-size: 10px;">CBA</a> <a href="../../tags/Client-Secrets/" style="font-size: 10px;">Client Secrets</a> <a href="../../tags/Cloud-Kerberos-Trust/" style="font-size: 10px;">Cloud Kerberos Trust</a> <a href="../../tags/Company-Branding/" style="font-size: 10px;">Company Branding</a> <a href="../../tags/Compliant/" style="font-size: 10.63px;">Compliant</a> <a href="../../tags/Conditional-Access/" style="font-size: 18.75px;">Conditional Access</a> <a href="../../tags/Conditional-Access-Policy/" style="font-size: 10.63px;">Conditional Access Policy</a> <a href="../../tags/Cross-Tenat-Synchronization/" style="font-size: 10px;">Cross-Tenat Synchronization</a> <a href="../../tags/Device/" style="font-size: 11.25px;">Device</a> <a href="../../tags/DirSync/" style="font-size: 10px;">DirSync</a> <a href="../../tags/Directory-Synchronization-Accounts/" style="font-size: 10px;">Directory Synchronization Accounts</a> <a href="../../tags/Entitlement-Management/" style="font-size: 11.25px;">Entitlement Management</a> <a href="../../tags/Entra-ID/" style="font-size: 10px;">Entra ID</a> <a href="../../tags/ExpressRoute/" style="font-size: 10px;">ExpressRoute</a> <a href="../../tags/Federated-Domain/" style="font-size: 10.63px;">Federated Domain</a> <a href="../../tags/Federation/" style="font-size: 10px;">Federation</a> <a href="../../tags/Global-Secure-Access/" style="font-size: 10px;">Global Secure Access</a> <a href="../../tags/HAADJ/" style="font-size: 10px;">HAADJ</a> <a href="../../tags/Hard-match/" style="font-size: 10px;">Hard match</a> <a href="../../tags/Hybrid-Azure-AD-Join/" style="font-size: 15.63px;">Hybrid Azure AD Join</a> <a href="../../tags/Identity-Governance/" style="font-size: 12.5px;">Identity Governance</a> <a href="../../tags/Identity-Protection/" style="font-size: 10.63px;">Identity Protection</a> <a href="../../tags/Intune/" style="font-size: 11.25px;">Intune</a> <a href="../../tags/Issuer-ID/" style="font-size: 10px;">Issuer ID</a> <a href="../../tags/Issuer-URI/" style="font-size: 10px;">Issuer URI</a> <a href="../../tags/Key-Vault/" style="font-size: 10px;">Key Vault</a> <a href="../../tags/Legacy-Authentication/" style="font-size: 10px;">Legacy Authentication</a> <a href="../../tags/Lifecycle-Workflow/" style="font-size: 10px;">Lifecycle Workflow</a> <a href="../../tags/Lifecycle-Workflows/" style="font-size: 10px;">Lifecycle Workflows</a> <a href="../../tags/Limitation/" style="font-size: 10px;">Limitation</a> <a href="../../tags/MFA/" style="font-size: 16.88px;">MFA</a> <a href="../../tags/Managed-Domain/" style="font-size: 10.63px;">Managed Domain</a> <a href="../../tags/Managed-ID/" style="font-size: 10.63px;">Managed ID</a> <a href="../../tags/Microsoft-Authenticator/" style="font-size: 11.25px;">Microsoft Authenticator</a> <a href="../../tags/Microsoft-Authenticator-%E3%82%A2%E3%83%97%E3%83%AA/" style="font-size: 10px;">Microsoft Authenticator アプリ</a> <a href="../../tags/Microsoft-Entra/" style="font-size: 17.5px;">Microsoft Entra</a> <a href="../../tags/Microsoft-Entra-ID/" style="font-size: 10px;">Microsoft Entra ID</a> <a href="../../tags/Microsoft-Entra-Join/" style="font-size: 10px;">Microsoft Entra Join</a> <a href="../../tags/Microsoft-Entra-hybrid-join/" style="font-size: 10px;">Microsoft Entra hybrid join</a> <a href="../../tags/Microsoft-Graph/" style="font-size: 13.75px;">Microsoft Graph</a> <a href="../../tags/Microsoft-Graph-PowerShell/" style="font-size: 10px;">Microsoft Graph PowerShell</a> <a href="../../tags/Microsoft-Graph-PowerShell-SDK/" style="font-size: 10px;">Microsoft Graph PowerShell SDK</a> <a href="../../tags/Multi-Factor-Authentication/" style="font-size: 10px;">Multi Factor Authentication</a> <a href="../../tags/Multi-Tenant-Organization/" style="font-size: 10px;">Multi Tenant Organization</a> <a href="../../tags/Network/" style="font-size: 10px;">Network</a> <a href="../../tags/OAuth/" style="font-size: 12.5px;">OAuth</a> <a href="../../tags/OTP/" style="font-size: 10px;">OTP</a> <a href="../../tags/PIM/" style="font-size: 10.63px;">PIM</a> <a href="../../tags/PIN/" style="font-size: 10px;">PIN</a> <a href="../../tags/PRT/" style="font-size: 10px;">PRT</a> <a href="../../tags/Password-Policy/" style="font-size: 10px;">Password Policy</a> <a href="../../tags/Password-Writeback/" style="font-size: 10px;">Password Writeback</a> <a href="../../tags/PowerShell/" style="font-size: 15px;">PowerShell</a> <a href="../../tags/Primary-Refresh-Token/" style="font-size: 10px;">Primary Refresh Token</a> <a href="../../tags/Provisioning/" style="font-size: 10px;">Provisioning</a> <a href="../../tags/RBAC/" style="font-size: 10.63px;">RBAC</a> <a href="../../tags/Role-Management/" style="font-size: 10px;">Role Management</a> <a href="../../tags/SAML/" style="font-size: 10px;">SAML</a> <a href="../../tags/SMTP/" style="font-size: 10px;">SMTP</a> <a href="../../tags/SSO/" style="font-size: 10px;">SSO</a> <a href="../../tags/SSPR/" style="font-size: 11.25px;">SSPR</a> <a href="../../tags/SameSite/" style="font-size: 10px;">SameSite</a> <a href="../../tags/Security/" style="font-size: 16.25px;">Security</a> <a href="../../tags/Security-Default/" style="font-size: 10px;">Security Default</a> <a href="../../tags/Self-Service-Password-Reset/" style="font-size: 10px;">Self Service Password Reset</a> <a href="../../tags/Service-Principal/" style="font-size: 10px;">Service Principal</a> <a href="../../tags/Signin-Logs/" style="font-size: 10px;">Signin Logs</a> <a href="../../tags/Smart-lockout/" style="font-size: 10px;">Smart lockout</a> <a href="../../tags/Soft-matching/" style="font-size: 10px;">Soft matching</a> <a href="../../tags/Staged-Rollout/" style="font-size: 10px;">Staged Rollout</a> <a href="../../tags/Subscription/" style="font-size: 10px;">Subscription</a> <a href="../../tags/TLS-1-2/" style="font-size: 10.63px;">TLS 1.2</a> <a href="../../tags/TPM/" style="font-size: 10px;">TPM</a> <a href="../../tags/Tenant-Restrictions/" style="font-size: 10px;">Tenant Restrictions</a> <a href="../../tags/Token/" style="font-size: 10.63px;">Token</a> <a href="../../tags/Troubleshooting/" style="font-size: 13.13px;">Troubleshooting</a> <a href="../../tags/Trusted-Platform-Module/" style="font-size: 10px;">Trusted Platform Module</a> <a href="../../tags/UPN/" style="font-size: 11.25px;">UPN</a> <a href="../../tags/US-Identity-Blog/" style="font-size: 19.38px;">US Identity Blog</a> <a href="../../tags/Verified-ID/" style="font-size: 10px;">Verified ID</a> <a href="../../tags/WAP/" style="font-size: 10px;">WAP</a> <a href="../../tags/WHfB/" style="font-size: 10px;">WHfB</a> <a href="../../tags/Windows-10/" style="font-size: 10px;">Windows 10</a> <a href="../../tags/Windows-Defender-ATP/" style="font-size: 10px;">Windows Defender ATP</a> <a href="../../tags/Windows-Hello-for-Business/" style="font-size: 12.5px;">Windows Hello for Business</a> <a href="../../tags/WorkPlace-Join/" style="font-size: 10px;">WorkPlace Join</a> <a href="../../tags/Workplace-Join/" style="font-size: 10.63px;">Workplace Join</a> <a href="../../tags/XTAP/" style="font-size: 10px;">XTAP</a> <a href="../../tags/Zero-Trust/" style="font-size: 13.75px;">Zero Trust</a> <a href="../../tags/graph-api/" style="font-size: 11.25px;">graph api</a> <a href="../../tags/signin-log/" style="font-size: 12.5px;">signin log</a> <a href="../../tags/supportMultipleDomain/" style="font-size: 10px;">supportMultipleDomain</a> <a href="../../tags/unusual-sign-in/" style="font-size: 10px;">unusual sign-in</a> <a href="../../tags/%E3%82%AF%E3%83%AC%E3%83%BC%E3%83%A0%E3%83%AB%E3%83%BC%E3%83%AB/" style="font-size: 10px;">クレームルール</a> <a href="../../tags/%E3%83%86%E3%83%8A%E3%83%B3%E3%83%88%E5%88%B6%E9%99%90/" style="font-size: 10px;">テナント制限</a> <a href="../../tags/%E3%83%88%E3%83%A9%E3%82%B9%E3%83%86%E3%83%83%E3%83%89-%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0-%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB/" style="font-size: 10px;">トラステッド プラットフォーム モジュール</a> <a href="../../tags/%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/" style="font-size: 13.75px;">トラブルシューティング</a> <a href="../../tags/%E3%83%AD%E3%82%B0%E5%8F%96%E5%BE%97/" style="font-size: 10px;">ログ取得</a> <a href="../../tags/%E6%83%85%E5%A0%B1%E6%8E%A1%E5%8F%96/" style="font-size: 10.63px;">情報採取</a> <a href="../../tags/%E6%9D%A1%E4%BB%B6%E4%BB%98%E3%81%8D%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9/" style="font-size: 10.63px;">条件付きアクセス</a> <a href="../../tags/%E8%A8%BC%E6%98%8E%E6%9B%B8/" style="font-size: 10px;">証明書</a> <a href="../../tags/%E8%A8%BC%E6%98%8E%E6%9B%B8%E8%AA%8D%E8%A8%BC/" style="font-size: 10px;">証明書認証</a>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <a href="https://privacy.microsoft.com/ja-jp/privacystatement" target="_blank" rel=”noopener”>Privacy & Cookies</a> |  
      <a href="https://www.microsoft.com/ja-jp/legal/intellectualproperty/copyright" target="_blank" rel=”noopener”>Terms of use</a> |
      <a href="https://www.microsoft.com/ja-jp/legal/intellectualproperty/trademarks" target="_blank" rel=”noopener”>Trademarks</a> |
      &copy; 2024 Azure Identity Support Japan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="../../index.html" class="mobile-nav-link">Home</a>
  
    <a href="../../archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="../../js/script.js"></script>




  </div>
</body>
</html>